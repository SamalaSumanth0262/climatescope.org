---
layout: entry
---
{% if page.lang %}
  {% assign language = page.lang %}
{% elsif site.collections[page.collection].lang %}
  {% assign language = site.collections[page.collection].lang %}
{% endif %}

<div class="row--contained">

  <div class="col--main">
    <h2>Description</h2>
    {{ content }}
  </div>

  <div class="col--sec">
    {% case language %}
    {% when 'en' %}
      <dl class="stats-list">
        <dt>Weight</dt>
        <dd>40<sup>%</sup></dd>
        <dt>Highest score <small>(Brazil)</small></dt>
        <dd>2.25</dd>
        <dt>Lowest score <small>(Botswana)</small></dt>
        <dd>0.83</dd>
      </dl>

    {% when 'es' %}

      <dl class="stats-list">
        <dt>Weight</dt>
        <dd>40<sup>%</sup></dd>
        <dt>Highest score <small>(Brazil)</small></dt>
        <dd>2.25</dd>
        <dt>Lowest score <small>(Botswana)</small></dt>
        <dd>0.83</dd>
      </dl>

    {% endcase %}
  </div>

</div>

<div class="row--contained">

<script>
    CS.parameterId = {{page.id}};
</script>

<script>


	var app = angular.module('parameterApp', ['mathFilters'], function($interpolateProvider) {
    $interpolateProvider.startSymbol('//');
    $interpolateProvider.endSymbol('//');
  });
  
  app.controller('CountryListController', ['$http', function($http) {
    var _self = this;
    // Data
    this.parameter = {};
    this.countries = [];
    this.scoreAvg = 0;
    
    setupCommonTableMethods(_self);
    
    var calcAvgScore = function() {
      var score = 0;
      angular.forEach(_self.countries, function(country) {
        score += country.data[0].value;
      });

      _self.scoreAvg = score / _self.countries.length;
    };
        
    this.getCountryUrl = function(country) {
      var iso = country.iso.toLowerCase();
      return _self.getTranslatedUrl('country', iso);
    };
    
    // ---- Logic ----
    var url = CS.domain + '/' + CS.lang + '/api/topic/' + CS.parameterId + '.json';
    $http.get(url).success(function(data) {

      angular.forEach(data.countries, function(country) {
        country.data.sort(function(a, b) {
          return b.year - a.year;
        });
      });

      _self.parameter = data;
      _self.countries = data.countries;
      calcAvgScore();
    });
        
  }]);
</script>

<div ng-app="parameterApp">
<div ng-controller="CountryListController as countryTable" ng-cloak>
  <table class="table">
    <thead>
      <tr>
        <th><a href="" ng-click="countryTable.setSort('overall_ranking')">Overall rank</a></th>
        <th><a href="" ng-click="countryTable.setSort('name')">Country</a></th>
        <th><a href="" ng-click="countryTable.setSort('score')">Overall score</a></th>
        <th><a href="" ng-click="countryTable.setSort('data[0].value')">Parameter</a></th>
        <th><a href="" ng-click="countryTable.setSort('grid')">Grid</a></th>
      </tr>
    </thead>
    <tbody ng-repeat="country in countryTable.countries | orderBy:countryTable.sortField:countryTable.sortReverse">
      <tr>
        <td>// country.overall_ranking //</td>
        <td><a href="//countryTable.getCountryUrl(country)//" title="Go to country page">// country.name //</a></td>
        <td>// country.score | round:3 //</td>
        
        <td>
          <ul class="table-bar">
            <li ng-class="'param-' + countryTable.parameter.id" style="width: //countryTable.calcBarSegment(country.data[0].value, countryTable.parameter.weight)//"><span class="visually-hidden">// country.data[0].value //</span>&nbsp;</li>
          </ul>
        </td>
        <td><em class="label-grid" ng-class="{'label-grid-on': country.grid == 'on', 'label-grid-off': country.grid == 'off'}"><span>// country.grid //</span></em></td>
      </tr>
    </tbody>
  </table>
</div>
</div>





</div>
