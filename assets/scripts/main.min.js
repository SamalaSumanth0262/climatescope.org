function createCookie(name,value,days,path){path=path||"/";var expires="";if(days){var date=new Date;date.setTime(date.getTime()+24*days*60*60*1e3),expires="; expires="+date.toGMTString()}document.cookie=name+"="+value+expires+"; path="+path}function readCookie(name){for(var nameEQ=name+"=",ca=document.cookie.split(";"),i=0;i<ca.length;i++){for(var c=ca[i];" "==c.charAt(0);)c=c.substring(1,c.length);if(0===c.indexOf(nameEQ))return c.substring(nameEQ.length,c.length)}return null}function eraseCookie(name,path){path=path||"/",createCookie(name,"",-1,path)}function debounce(func,wait,immediate){var timeout;return function(){var context=this,args=arguments;clearTimeout(timeout),timeout=setTimeout(function(){timeout=null,immediate||func.apply(context,args)},wait),immediate&&!timeout&&func.apply(context,args)}}function setupCommonTableMethods(scope){scope.sortField="score",scope.sortReverse=!0,scope.setSort=function(field){scope.sortField=field,scope.sortReverse=!_self.sortReverse},scope.checkSortClasses=function(field){return scope.sortField!=field?"sort-none":scope.sortReverse===!0?"sort-desc":"sort-asc"},scope.calcBarSegment=function(param){return weight=null!=param.weight?param.weight:.25,param.value*weight*20+"%"},scope.getTranslatedUrl=function(subject,id){switch(subject){case"country":return CS.countryIndex?CS.countryIndex[id]:"";case"state":return CS.stateIndex?CS.stateIndex[id]:"";default:return""}}}!function($){$.fn.trSlideUp=function(){return this.filter("tr").each(function(){var _self=$(this);_self.children("td").each(function(){0===$(this).children("div.tr-slide-wrapper").length&&$(this).wrapInner("<div class='tr-slide-wrapper'></div>"),$(this).children("div.tr-slide-wrapper").slideUp(function(){_self.hide()})})})},$.fn.trSlideDown=function(){return this.filter("tr").each(function(){var _self=$(this);_self.show(),_self.children("td").each(function(){0===$(this).children("div.tr-slide-wrapper").length&&$(this).wrapInner("<div class='tr-slide-wrapper' style='display: none'></div>"),$(this).children("div.tr-slide-wrapper").slideDown()})})}}(jQuery),$(document).ready(function(){var rank=function(){function reset(){var bounds=path.bounds({type:"FeatureCollection",features:land}),topLeft=bounds[0],bottomRight=bounds[1],transform=[-topLeft[0]+50,-topLeft[1]+50];svg.attr("width",bottomRight[0]-topLeft[0]+100).attr("height",bottomRight[1]-topLeft[1]+100).style("left",topLeft[0]-50+"px").style("top",topLeft[1]-50+"px"),g.attr("transform","translate("+transform[0]+","+transform[1]+")")}function getSlice(land,visibleCountries){return 0===visibleCountries?land:-1===visibleCountries?land.slice(-10):land.slice(0,10)}function redraw(){var data=getSlice(land,visibleCountries);g.selectAll(".rank-marker").remove(),markers=g.selectAll(".rank-marker").data(data).enter().append("g").attr("class","rank-marker").style("opacity",0).attr("transform",function(d){return"translate("+path.centroid(d)+")"}),markers.append("circle").attr("r",16).on("mouseover",function(d){clicked||tooltip.show(d)}).on("mouseout",function(){clicked||tooltip.hide()}).on("click",function(d){clicked=!0,tooltip.show(d),window.setTimeout(function(){$(document).one("click",function(e){"circle"!==e.target.localName&&(clicked=!1,tooltip.hide())})},100)}),markers.append("text").attr("dy","6px").text(function(d){return d.d<10?"0"+d.d:d.d}),markers.transition().delay(function(d,i){return 200+20*i}).duration(200).style("opacity",1)}function toZoom(visibleCountries){0===visibleCountries&&4>zoom?map.setZoom(4):0!==visibleCountries&&zoom>2&&map.setZoom(2)}var land,indicators,markers,undef,map=L.mapbox.map("index-viz","derrr.f5dvlsor").setView([0,0],2),point=function(x,y){var pt=map.latLngToLayerPoint([y,x]);this.stream.point(pt.x,pt.y)},projection=d3.geo.transform({point:point}),path=d3.geo.path().projection(projection),clicked=!1,tooltip=d3.tip().attr("class","rank-tooltip").html(function(d){return d=d.rank,['<div class="rank-tooltip-head"><label>Region goes here</label>',"<h5>"+d.name,'</h5><span class="rank-tooltip-close">&#10005;</span></div>','<div class="rank-tooltip-body">','<table><tr><td class="first">'+d.overall_ranking,"</td><td>Rank</td></tr>",'<tr><td class="first">'+d.score,"</td><td>Score</td></tr>",'<tr><td class="first">'+d.parameters[0].value,'</td><td class="tooltip-table-indicator indicator-0">Enabling Framework</td></tr>','<tr><td class="first">'+d.parameters[1].value,'</td><td class="tooltip-table-indicator indicator-1">Financing & Investment</td></tr>','<tr><td class="first">'+d.parameters[2].value,'</td><td class="tooltip-table-indicator indicator-2">Value Chains</td></tr>','<tr><td class="first">'+d.parameters[3].value,'</td><td class="tooltip-table-indicator indicator-3">GHG Management</td></tr>',"</table>",'<button class="rank-tooltip-link">View Country &rsaquo;</button>',"</div>"].join(" ")}),$countryFilter=$("<ul>",{"class":"leaflet-control bttn-group bttn-group-s bttn-list map-country-toggle"}),svg=d3.select(map.getPanes().overlayPane).append("svg:svg").call(tooltip),g=svg.append("svg:g").attr("class","leaflet-zoom-hide"),countryFilter={"bottom-ten":-1,"top-ten":1,all:0},visibleCountries=countryFilter["top-ten"],zoom=map.getZoom();queue().defer(d3.json,CS.domain+"/"+CS.lang+"/api/countries.topojson").defer(d3.json,CS.domain+"/"+CS.lang+"/api/countries.json").await(function(error,geography,countryRank){land=topojson.feature(geography,geography.objects.countries).features,indicators=countryRank;for(var iso,lookup={},max=[],filtered=[],i=0,ii=indicators.length;ii>i;++i)lookup[indicators[i].iso]=i,max.push(indicators[i].overall_ranking);for(i=0,ii=land.length;ii>i;++i)iso=land[i].id,lookup[iso]!==undef&&(land[i].rank=indicators[lookup[iso]],land[i].d=land[i].rank.overall_ranking,filtered.push(land[i]));land=filtered.sort(function(a,b){return a.d-b.d}),reset(),redraw(),$countryFilter.on("click","button",function(e){var cls=e.currentTarget.className,toShow=countryFilter[cls.slice(cls.indexOf("show")+5)];visibleCountries!==toShow&&($countryFilter.find(".active").removeClass("active"),e.currentTarget.className="active "+cls,toZoom(visibleCountries=toShow),redraw())}),$.each(countryFilter,function(key){var cls="bttn bttn-default show-"+key;"top-ten"===key&&(cls="active "+cls),$("<button>",{type:"button","class":cls,text:key.split("-").join(" ")}).appendTo($countryFilter)}),$countryFilter.appendTo($(".leaflet-bottom.leaflet-left"))}),map.on("viewreset",function(){if(reset(),zoom=map.getZoom(),0===visibleCountries&&4>zoom){visibleCountries=1,redraw(),$countryFilter.find(".active").removeClass("active");var topTen=document.querySelectorAll(".show-top-ten")[0];topTen.className="active "+topTen.className}else markers.attr("transform",function(d){return"translate("+path.centroid(d)+")"})});var updateSliders=debounce(function(e,weight){for(var d={},i=0,ii=land.length;ii>i;++i)d=land[i].rank.parameters,land[i].rank.score=Math.round(weight[1]*d[0].value+weight[2]*d[1].value+weight[3]*d[2].value+weight[4]*d[3].value)/100;for(land=land.sort(function(a,b){return b.rank.score-a.rank.score}),i=0;ii>i;++i)land[i].d=land[i].rank.overall_ranking=i+1;redraw()},100,!1);$(".slider-group").on("update-sliders",updateSliders)},parent=document.querySelector("#index-viz");parent&&new rank}),$(function(){$('[data-toggle="dropdown"]').click(function(e){e.preventDefault(),e.stopPropagation();var parent=$(this).parent(".dropdown");parent.toggleClass("open"),$(".dropdown.open").not(parent).removeClass("open")}),$(document).click(function(){$(".dropdown.open").removeClass("open")}),"hide"!=readCookie("welcome_modal")&&$("#welcome").addClass("revealed"),$("[data-modal-dismiss]").click(function(e){e.preventDefault(),createCookie("welcome_modal","hide",10,"/"+CS.lang)})}),$(document).ready(function(){if(0!==$("#parameters-controls").length){var header_height=$("#site-header").outerHeight(),check_sticky=function(){$(document).scrollTop()>=header_height?$("#parameters-controls").hasClass("sticky")||($("#parameters-controls").addClass("sticky"),check_sticky_padding()):($("#parameters-controls").removeClass("sticky"),check_sticky_padding())},check_sticky_padding=function(){var parameter_controls=$("#parameters-controls");if("fixed"==parameter_controls.css("position")){var parameter_height=parameter_controls.outerHeight();parameter_controls.parent().css("padding-top",parameter_height)}else parameter_controls.parent().css("padding-top",0)};$(document).on("scroll",check_sticky),$(window).on("resize",debounce(function(){header_height=$("#site-header").outerHeight(),check_sticky_padding()},50)),check_sticky();var appElement=document.querySelector("[ng-app=countryListApp]"),countryAppScope=angular.element(appElement).scope();$(".slider-group").sliderGroup({start:25,range:{min:0,max:100},connect:"lower",step:1,animate:!1}).on("update-sliders",function(event,data){countryAppScope.$apply(function(){var countries=countryAppScope.countryTable.countries,updateParams=function(params){var globalScore=0;return angular.forEach(params,function(param){param.weight=data[param.id]/100,globalScore+=param.weight*param.value}),Math.round(100*globalScore)/100};angular.forEach(countries,function(country){var newCountryScore=updateParams(country.parameters);country.score=newCountryScore}),countries.sort(function(a,b){return b.score-a.score}),angular.forEach(countries,function(country,key){country.overall_ranking=key+1,angular.forEach(country.states,function(state){var newStateScore=updateParams(state.parameters);state.score=newStateScore}),country.states.sort(function(a,b){return b.score-a.score}),angular.forEach(country.states,function(state,key){state.state_ranking=key+1})})}),$(".slider-value.one").text(data[1]+"%"),$(".slider-value.two").text(data[2]+"%"),$(".slider-value.three").text(data[3]+"%"),$(".slider-value.four").text(data[4]+"%")}),$("#vis-controls .reset").click(function(e){e.preventDefault(),$("#vis-controls.slider-group").sliderGroup("reset")})}}),$(function(){$(".browsehappy").on("click",function(){$(this).slideUp("fast")})}),function($){$(function(){$("[data-modal-id]").click(function(e){e.preventDefault();var id=$(this).attr("data-modal-id");$("#"+id).addClass("revealed")}),$(".modal").click(function(e){e.target==e.currentTarget&&$(this).removeClass("revealed")}),$("[data-modal-dismiss]").click(function(e){e.preventDefault(),$(this).closest(".modal").removeClass("revealed")})})}(jQuery),function($){function sliderGroup(options){var $group=$(this),sliders=$(".slider",$group),getGroupTotal=function(){var total=0;return sliders.each(function(){total+=parseFloat($(this).val())}),total},getSlidersData=function(){var data={};return sliders.each(function(index){var id=$(this).attr("id")||index;data[id]=parseFloat($(this).val())}),data},setSlidersDefaultValues=function(){sliders.each(function(){var starting=$(this).attr("data-starting");if(!starting)throw Error("sliderGroup: missing 'data-starting' attribute.");$(this).val($(this).attr("data-starting"))});var data=getSlidersData();$group.trigger("update-sliders",[data])};return"reset"==options?(setSlidersDefaultValues(),sliders.siblings(".lock").find(".switch-checkbox").removeAttr("checked").trigger("change"),this):(sliders.noUiSlider(options),setSlidersDefaultValues(),setTimeout(function(){var data=getSlidersData();$group.trigger("update-sliders",[data])},10),sliders.on("slide",function(){var _self=this,_selfValue=parseFloat($(this).val()),total=getGroupTotal(),delta=100-total,slidersToChange=sliders.not(_self).not("[disabled]"),countSliders=slidersToChange.length;slidersToChange.each(function(){var value=parseFloat($(this).val()),new_value=value+delta/countSliders;(0>new_value||100==_selfValue)&&(new_value=0),new_value>100&&(new_value=100),$(this).val(new_value)});var updatedTotal=getGroupTotal(),updatedOthersTotal=updatedTotal-_selfValue;100!=updatedTotal&&$(_self).val(100-updatedOthersTotal);var data=getSlidersData();$group.trigger("update-sliders",[data])}),sliders.each(function(){var $slider=$(this);$slider.siblings(".lock").find(".switch-checkbox").change(function(){$(this).is(":checked")?$slider.attr("disabled","disabled"):$slider.removeAttr("disabled")})}),this)}$.fn.sliderGroup=function(options){return this.each(function(){return sliderGroup.apply(this,[options])})}}(jQuery),function(){var app=angular.module("countryApp",["ngRoute","countryAppControllers"],function($interpolateProvider){$interpolateProvider.startSymbol("//"),$interpolateProvider.endSymbol("//")});app.config(["$routeProvider",function($routeProvider){$routeProvider.when("/details",{templateUrl:"in_detail.html",controller:"DetailsTabController",controllerAs:"detailsCtrl",activeTab:"details"}).when("/states",{templateUrl:"states.html",controller:"StatesTabController",controllerAs:"statesCtrl",activeTab:"states"}).when("/case-study",{templateUrl:"case_study.html",controller:"CaseStudyTabController",controllerAs:"caseStudyCtrl",activeTab:"case_study"}).otherwise({redirectTo:"/details"})}]),app.factory("CountryData",["$http",function($http){var cache;return this.get=function(cb){if(cache)cb(cache);else{var url=CS.domain+"/"+CS.lang+"/api/countries/"+CS.countryId+".json";$http.get(url).success(function(data){cache=data,cb(data)})}},this}]);var countryAppControllers=angular.module("countryAppControllers",[]);countryAppControllers.controller("CountryTabsController",["$http","$route",function($http,$route){this.isActive=function(name){return $route.current?$route.current.activeTab==name:!1}}]),countryAppControllers.controller("DetailsTabController",["$http","$route",function(){}]),countryAppControllers.controller("StatesTabController",["$http","$route","$location","CountryData",function($http,$route,$location,CountryData){_self=this,CS.countryHasStates||$location.path("/details"),this.states=[],setupCommonTableMethods(_self),this.getStateUrl=function(state){var iso=state.iso.toLowerCase();return _self.getTranslatedUrl("state",iso)},CountryData.get(function(data){_self.states=data.states})}]),countryAppControllers.controller("CaseStudyTabController",["$http","$route",function(){}])}(),function(){var app=angular.module("countryListApp",[],function($interpolateProvider){$interpolateProvider.startSymbol("//"),$interpolateProvider.endSymbol("//")});app.controller("CountryListController",["$http",function($http){_self=this,this.countries=[],setupCommonTableMethods(_self);var getRequestUrl=function(regionId){return regionId=regionId||null,null==regionId?CS.domain+"/"+CS.lang+"/api/countries.json":CS.domain+"/"+CS.lang+"/api/regions/"+regionId+".json"};this.getCountryUrl=function(country){var iso=country.iso.toLowerCase();return _self.getTranslatedUrl("country",iso)},this.getStateUrl=function(state){var iso=state.iso.toLowerCase();return _self.getTranslatedUrl("state",iso)},this.toggleStates=function($event){var tbody=jQuery($event.target).closest("tbody"),statesRow=tbody.find(".country-states");statesRow.is(":hidden")?(tbody.addClass("open"),statesRow.trSlideDown()):(tbody.removeClass("open"),statesRow.trSlideUp())},CS.regionId?$http.get(getRequestUrl(CS.regionId)).success(function(data){_self.countries=data.countries}):$http.get(getRequestUrl()).success(function(data){_self.countries=data})}])}(),function(a){function q(d){return"number"==typeof d&&!isNaN(d)&&isFinite(d)}function s(d,g){return 100*g/(d[1]-d[0])}function p(d,g){for(var e=1;d>=g[e];)e+=1;return e}function k(d,g,e,a){this.xPct=[],this.xVal=[],this.xSteps=[a||!1],this.xNumSteps=[!1],this.snap=g,this.direction=e;for(var f in d)if(d.hasOwnProperty(f)){if(g=f,e=d[f],a=void 0,"number"==typeof e&&(e=[e]),"[object Array]"!==Object.prototype.toString.call(e))throw Error("noUiSlider: 'range' contains invalid value.");if(a="min"===g?0:"max"===g?100:parseFloat(g),!q(a)||!q(e[0]))throw Error("noUiSlider: 'range' value isn't numeric.");this.xPct.push(a),this.xVal.push(e[0]),a?this.xSteps.push(isNaN(e[1])?!1:e[1]):isNaN(e[1])||(this.xSteps[0]=e[1])}this.xNumSteps=this.xSteps.slice(0);for(f in this.xNumSteps)this.xNumSteps.hasOwnProperty(f)&&(d=Number(f),(g=this.xNumSteps[f])&&(this.xSteps[d]=s([this.xVal[d],this.xVal[d+1]],g)/(100/(this.xPct[d+1]-this.xPct[d]))))}k.prototype.getMargin=function(d){return 2===this.xPct.length?s(this.xVal,d):!1},k.prototype.toStepping=function(d){var g=this.xVal,a=this.xPct;if(d>=g.slice(-1)[0])d=100;else{var f,k,m=p(d,g);f=g[m-1],k=g[m],g=a[m-1],a=a[m],f=[f,k],d=s(f,0>f[0]?d+Math.abs(f[0]):d-f[0]),d=g+d/(100/(a-g))}return this.direction&&(d=100-d),d},k.prototype.fromStepping=function(d){this.direction&&(d=100-d);var a,e=this.xVal;if(a=this.xPct,d>=100)a=e.slice(-1)[0];else{var f,k,m=p(d,a);f=e[m-1],k=e[m],e=a[m-1],f=[f,k],a=100/(a[m]-e)*(d-e)*(f[1]-f[0])/100+f[0]}return d=Math.pow(10,7),Number((Math.round(a*d)/d).toFixed(7))},k.prototype.getStep=function(d){this.direction&&(d=100-d);var a=this.xPct,e=this.xSteps,k=this.snap;if(100!==d){var f=p(d,a);k?(e=a[f-1],a=a[f],d=d-e>(a-e)/2?a:e):(e[f-1]?(k=a[f-1],e=e[f-1],a=Math.round((d-a[f-1])/e)*e,a=k+a):a=d,d=a)}return this.direction&&(d=100-d),d},k.prototype.getApplicableStep=function(a){var g=p(a,this.xPct);return a=100===a?2:1,[this.xNumSteps[g-2],this.xVal[g-a],this.xNumSteps[g-a]]},k.prototype.convert=function(a){return this.getStep(this.toStepping(a))},a.noUiSlider={Spectrum:k}}(window.jQuery||window.Zepto),function(a){function q(c){return"number"==typeof c&&!isNaN(c)&&isFinite(c)}function s(c,b){if(!q(b))throw Error("noUiSlider: 'step' is not numeric.");c.singleStep=b}function p(c,b){if("object"!=typeof b||a.isArray(b))throw Error("noUiSlider: 'range' is not an object.");if(void 0===b.min||void 0===b.max)throw Error("noUiSlider: Missing 'min' or 'max' in 'range'.");c.spectrum=new a.noUiSlider.Spectrum(b,c.snap,c.dir,c.singleStep)}function k(c,b){var d=b;if(b=a.isArray(d)?d:[d],!a.isArray(b)||!b.length||2<b.length)throw Error("noUiSlider: 'start' option is incorrect.");c.handles=b.length,c.start=b}function d(c,b){if(c.snap=b,"boolean"!=typeof b)throw Error("noUiSlider: 'snap' option must be a boolean.")}function g(c,b){if(c.animate=b,"boolean"!=typeof b)throw Error("noUiSlider: 'animate' option must be a boolean.")}function e(c,b){if("lower"===b&&1===c.handles)c.connect=1;else if("upper"===b&&1===c.handles)c.connect=2;else if(!0===b&&2===c.handles)c.connect=3;else{if(!1!==b)throw Error("noUiSlider: 'connect' option doesn't match handle count.");c.connect=0}}function m(c,b){switch(b){case"horizontal":c.ort=0;break;case"vertical":c.ort=1;break;default:throw Error("noUiSlider: 'orientation' option is invalid.")}}function f(c,b){if(!q(b))throw Error("noUiSlider: 'margin' option must be numeric.");if(c.margin=c.spectrum.getMargin(b),!c.margin)throw Error("noUiSlider: 'margin' option is only supported on linear sliders.")}function x(c,b){if(!q(b))throw Error("noUiSlider: 'limit' option must be numeric.");if(c.limit=c.spectrum.getMargin(b),!c.limit)throw Error("noUiSlider: 'limit' option is only supported on linear sliders.")}function y(c,b){switch(b){case"ltr":c.dir=0;break;case"rtl":c.dir=1,c.connect=[0,2,1,3][c.connect];break;default:throw Error("noUiSlider: 'direction' option was not recognized.")}}function t(c,b){if("string"!=typeof b)throw Error("noUiSlider: 'behaviour' must be a string containing options.");var a=0<=b.indexOf("tap"),d=0<=b.indexOf("drag"),e=0<=b.indexOf("fixed"),f=0<=b.indexOf("snap");c.events={tap:a||f,drag:d,fixed:e,snap:f}}function u(c,b){if(c.format=b,"function"==typeof b.to&&"function"==typeof b.from)return!0;throw Error("noUiSlider: 'format' requires 'to' and 'from' methods.")}var h={to:function(c){return c.toFixed(2)},from:Number};a.noUiSlider.testOptions=function(c){var G,b={margin:0,limit:0,animate:!0,format:h};return G={step:{r:!1,t:s},start:{r:!0,t:k},connect:{r:!0,t:e},direction:{r:!0,t:y},snap:{r:!1,t:d},animate:{r:!1,t:g},range:{r:!0,t:p},orientation:{r:!1,t:m},margin:{r:!1,t:f},limit:{r:!1,t:x},behaviour:{r:!0,t:t},format:{r:!1,t:u}},c=a.extend({connect:!1,direction:"ltr",behaviour:"tap",orientation:"horizontal"},c),a.each(G,function(a,d){if(void 0===c[a]){if(d.r)throw Error("noUiSlider: '"+a+"' is required.");return!0}d.t(b,c[a])}),b.style=b.ort?"top":"left",b}}(window.jQuery||window.Zepto),function(a){function q(c){return Math.max(Math.min(c,100),0)}function s(c,b,a){c.addClass(b),setTimeout(function(){c.removeClass(b)},a)}function p(c,b){var d=a("<div><div/></div>").addClass(h[2]),e=["-lower","-upper"];return c&&e.reverse(),d.children().addClass(h[3]+" "+h[3]+e[b]),d}function k(a,b,d){switch(a){case 1:b.addClass(h[7]),d[0].addClass(h[6]);break;case 3:d[1].addClass(h[6]);case 2:d[0].addClass(h[7]);case 0:b.addClass(h[6])}}function d(a,b,d){var e,f=[];for(e=0;a>e;e+=1)f.push(p(b,e).appendTo(d));return f}function g(c,b,d){return d.addClass([h[0],h[8+c],h[4+b]].join(" ")),a("<div/>").appendTo(d).addClass(h[1])}function e(c,b,e){function f(){return v[["width","height"][b.ort]]()}function m(b){var a,c=[n.val()];for(a=0;a<b.length;a+=1)n.trigger(b[a],c)}function p(a){return 1===a.length?a[0]:b.dir?a.reverse():a}function x(b){return function(a,c){n.val([b?null:c,b?c:null],!0)}}function t(b){var c=a.inArray(b,w);n[0].linkAPI&&n[0].linkAPI[b]&&n[0].linkAPI[b].change(B[c],l[c].children(),n)}function C(a,c,d){var e=a[0]!==l[0][0]?1:0,H=r[0]+b.margin,f=r[1]-b.margin,g=r[0]+b.limit,k=r[1]-b.limit;return 1<l.length&&(c=e?Math.max(c,H):Math.min(c,f)),!1!==d&&b.limit&&1<l.length&&(c=e?Math.min(c,g):Math.max(c,k)),c=z.getStep(c),c=q(parseFloat(c.toFixed(7))),c===r[e]?!1:(a.css(b.style,c+"%"),a.is(":first-child")&&a.toggleClass(h[17],c>50),r[e]=c,B[e]=z.fromStepping(c),t(w[e]),!0)}function A(a,c,d,e){return a=a.replace(/\s/g,".nui ")+".nui",c.on(a,function(a){if(n.attr("disabled")||n.hasClass(h[14]))return!1;a.preventDefault();var D,g,c=0===a.type.indexOf("touch"),f=0===a.type.indexOf("mouse"),E=0===a.type.indexOf("pointer"),k=a;0===a.type.indexOf("MSPointer")&&(E=!0),a.originalEvent&&(a=a.originalEvent),c&&(D=a.changedTouches[0].pageX,g=a.changedTouches[0].pageY),(f||E)&&(E||void 0!==window.pageXOffset||(window.pageXOffset=document.documentElement.scrollLeft,window.pageYOffset=document.documentElement.scrollTop),D=a.clientX+window.pageXOffset,g=a.clientY+window.pageYOffset),k.points=[D,g],k.cursor=f,a=k,a.calcPoint=a.points[b.ort],d(a,e)})}function I(a,b){var d,c=b.handles||l,e=!1,e=100*(a.calcPoint-b.start)/f(),g=c[0][0]!==l[0][0]?1:0,h=b.positions;d=e+h[0],e+=h[1],1<c.length?(0>d&&(e+=Math.abs(d)),e>100&&(d-=e-100),d=[q(d),q(e)]):d=[d,e],e=C(c[0],d[g],1===c.length),1<c.length&&(e=C(c[1],d[g?0:1],!1)||e),e&&m(["slide"])}function J(b){a("."+h[15]).removeClass(h[15]),b.cursor&&a("body").css("cursor","").off(".nui"),y.off(".nui"),n.removeClass(h[12]),m(["set","change"])}function F(b,c){1===c.handles.length&&c.handles[0].children().addClass(h[15]),b.stopPropagation(),A(u.move,y,I,{start:b.calcPoint,handles:c.handles,positions:[r[0],r[l.length-1]]}),A(u.end,y,J,null),b.cursor&&(a("body").css("cursor",a(b.target).css("cursor")),1<l.length&&n.addClass(h[12]),a("body").on("selectstart.nui",!1))}function K(c){var d=c.calcPoint,e=0;c.stopPropagation(),a.each(l,function(){e+=this.offset()[b.style]}),e=e/2>d||1===l.length?0:1,d-=v.offset()[b.style],d=100*d/f(),b.events.snap||s(n,h[14],300),C(l[e],d),m(["slide","set","change"]),b.events.snap&&F(c,{handles:[l[e]]})}var v,l,n=a(c),r=[-1,-1],z=b.spectrum,B=[],w=["lower","upper"].slice(0,b.handles);if(b.dir&&w.reverse(),c.LinkUpdate=t,c.LinkConfirm=function(c,d){var e=a.inArray(c,w);return d&&d.appendTo(l[e].children()),b.dir&&(e=1===e?0:1),x(e)},c.LinkDefaultFormatter=b.format,c.LinkDefaultFlag="lower",c.reappend=function(){var a,b;for(a=0;a<w.length;a+=1)this.linkAPI&&this.linkAPI[b=w[a]]&&this.linkAPI[b].reconfirm(b)},n.hasClass(h[0]))throw Error("Slider was already initialized.");v=g(b.dir,b.ort,n),l=d(b.handles,b.dir,v),k(b.connect,n,l),function(a){var b;if(!a.fixed)for(b=0;b<l.length;b+=1)A(u.start,l[b].children(),F,{handles:[l[b]]});a.tap&&A(u.start,v,K,{handles:l}),a.drag&&(b=v.find("."+h[7]).addClass(h[10]),a.fixed&&(b=b.add(v.children().not(b).children())),A(u.start,b,F,{handles:l}))}(b.events),c.vSet=function(c){if(n[0].LinkIsEmitting)return this;var d;c=a.isArray(c)?c:[c],b.dir&&1<b.handles&&c.reverse(),b.animate&&-1!==r[0]&&s(n,h[14],300),d=1<l.length?3:1,1===c.length&&(d=1);var e,f,g;for(b.limit&&(d+=1),e=0;d>e;e+=1)f=e%2,g=c[f],null!==g&&!1!==g&&("number"==typeof g&&(g=String(g)),g=b.format.from(g),(!1===g||isNaN(g)||!1===C(l[f],z.toStepping(g),e===3-b.dir))&&t(w[f]));return m(["set"]),this},c.vGet=function(){var a,c=[];for(a=0;a<b.handles;a+=1)c[a]=b.format.to(B[a]);return p(c)},c.destroy=function(){return a(this).off(".nui").removeClass(h.join(" ")).empty(),delete this.LinkUpdate,delete this.LinkConfirm,delete this.LinkDefaultFormatter,delete this.LinkDefaultFlag,delete this.reappend,delete this.vGet,delete this.vSet,delete this.getCurrentStep,delete this.getInfo,delete this.destroy,e},c.getCurrentStep=function(){var b=a.map(r,function(a,b){var c=z.getApplicableStep(a);return[[B[b]-c[2]>=c[1]?c[2]:c[0],c[2]]]});return p(b)},c.getInfo=function(){return[z,b.style,b.ort]},n.val(b.start)}function m(c){if(!this.length)throw Error("noUiSlider: Can't initialize slider on empty selection.");var b=a.noUiSlider.testOptions(c,this);return this.each(function(){e(this,b,c)})}function f(c){return this.each(function(){if(this.destroy){var b=a(this).val(),d=this.destroy(),e=a.extend({},d,c);a(this).noUiSlider(e),this.reappend(),d.start===e.start&&a(this).val(b)}else a(this).noUiSlider(c)})}function x(){return this[0][arguments.length?"vSet":"vGet"].apply(this[0],arguments)}var y=a(document),t=a.fn.val,u=window.navigator.pointerEnabled?{start:"pointerdown",move:"pointermove",end:"pointerup"}:window.navigator.msPointerEnabled?{start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}:{start:"mousedown touchstart",move:"mousemove touchmove",end:"mouseup touchend"},h="noUi-target noUi-base noUi-origin noUi-handle noUi-horizontal noUi-vertical noUi-background noUi-connect noUi-ltr noUi-rtl noUi-dragable  noUi-state-drag  noUi-state-tap noUi-active  noUi-stacking".split(" ");a.fn.val=function(){var c=arguments,b=a(this[0]);return arguments.length?this.each(function(){(a(this).hasClass(h[0])?x:t).apply(a(this),c)}):(b.hasClass(h[0])?x:t).call(b)},a.fn.noUiSlider=function(a,b){return(b?f:m).call(this,a)}}(window.jQuery||window.Zepto);