function debounce(func,wait,immediate){var timeout;return function(){var context=this,args=arguments;clearTimeout(timeout),timeout=setTimeout(function(){timeout=null,immediate||func.apply(context,args)},wait),immediate&&!timeout&&func.apply(context,args)}}$(document).ready(function(){var rank=function(parent){var $parent=$(parent),width=$parent.width(),height=256,tooltipHTML=function(d){return["<h5>#"+d.overall_ranking,d.name,"</h5><p>Score:<strong>",d.score,"</strong></p>"].join(" ")},tooltip=d3.tip().attr("class","map-tooltip").html(tooltipHTML),mouseover=function(d){d.rank?tooltip.show(d.rank):tooltip.hide()},mouseout=function(){tooltip.hide()},redraw=function(){},svg=d3.select(".map").append("svg").attr("width",width).attr("height",height).call(tooltip),projection=d3.geo.mercator(),path=d3.geo.path(),g=svg.append("g"),legendWidth=320,legendHeight=50,margin=[8,15,5,15],legend=width<legendWidth+20+margin[1]+margin[3]?null:svg.append("g").attr("class","map-legend").attr("transform","translate("+(width-legendWidth-20-margin[1]-margin[3])+","+(height-20-legendHeight-margin[0]-margin[2])+")");projection.translate([width/2,height/2]).scale(105),path.projection(projection),$parent.on("weight:change",redraw),queue().defer(d3.json,CS.domain+"/"+CS.lang+"/api/countries.topojson").defer(d3.json,CS.domain+"/"+CS.lang+"/api/countries.json").await(function(error,land,indicators){for(var undef,iso,land=topojson.feature(land,land.objects.countries).features,lookup={},max=[],i=0,ii=indicators.length;ii>i;++i)lookup[indicators[i].iso]=i,max.push(indicators[i].overall_ranking);for(i=0,ii=land.length;ii>i;++i)iso=land[i].id,land[i].rank=lookup[iso]!==undef?indicators[lookup[iso]]:undef;var colors=["rgb(240,249,232)","rgb(204,235,197)","rgb(168,221,181)","rgb(123,204,196)","rgb(67,162,202)","rgb(8,104,172)"],fill=d3.scale.quantize().domain([0,d3.max(max)]).range(colors),defaultFill="#fcfcfc";g.selectAll("path").data(land).enter().append("path").attr("d",path).style("fill",function(d){return d.rank===undef?defaultFill:fill(d.rank.overall_ranking)}).on("mouseover",mouseover).on("mouseout",mouseout),legend.append("rect").attr("x",0).attr("y",0).attr("rx",5).attr("ry",5).attr("width",legendWidth+margin[1]+margin[3]).attr("height",legendHeight+margin[0]+margin[2]).style("fill","#fff"),legend.append("text").attr("x",margin[3]).attr("y",margin[0]).attr("dy","1em").style("font-style","italic").text("Overall ranking");var legendUnits=legend.append("g").attr("transform","translate("+margin[3]+","+margin[0]+")").selectAll(".legend-unit").data(fill.range()).enter().append("g").attr("class","legend-unit"),unitWidth=Math.floor(legendWidth/colors.length);legendUnits.append("rect").attr("x",function(d,i){return i*unitWidth}).attr("y","1.275em").attr("width",unitWidth).attr("height",10).style("fill",function(d){return d}),legendUnits.append("text").attr("x",function(d,i){return i*unitWidth+unitWidth/2}).attr("y","3em").attr("dy","1em").style("text-anchor","middle").text(function(d){var extent=fill.invertExtent(d);return Math.ceil(extent[0])+" - "+Math.floor(extent[1])})})},parent=document.querySelectorAll(".map");parent.length&&rank(parent)}),$(function(){$("#section-switch a").click(function(e){e.preventDefault(),$("#section-switch li").removeClass("active"),$(this).parent("li").addClass("active"),$(".tab-content").addClass("hidden");var dest=$(this).attr("href");$(dest).removeClass("hidden")}),$('[data-toggle="dropdown"]').click(function(e){e.preventDefault(),e.stopPropagation();var parent=$(this).parent(".dropdown");parent.toggleClass("open"),$(".dropdown.open").not(parent).removeClass("open")}),$(document).click(function(){$(".dropdown.open").removeClass("open")})}),$(document).ready(function(){var header_height=$("#site-header").outerHeight(),check_sticky=function(){$(document).scrollTop()>=header_height?$("#parameters-controls").addClass("sticky"):$("#parameters-controls").removeClass("sticky")};$(document).on("scroll",check_sticky),$(window).on("resize",debounce(function(){header_height=$("#site-header").outerHeight()},50)),check_sticky()}),$(function(){$(".browsehappy").on("click",function(){$(this).slideUp("fast")})}),function(){var app=angular.module("countryApp",[],function($interpolateProvider){$interpolateProvider.startSymbol("//"),$interpolateProvider.endSymbol("//")});app.controller("CountryListController",["$http",function($http){_self=this,this.countries=[],this.sortField="overall_ranking",this.sortReverse=!1;var getRequestUrl=function(regionId){return regionId=regionId||null,null==regionId?CS.domain+"/"+CS.lang+"/api/countries.json":CS.domain+"/"+CS.lang+"/api/regions/"+regionId+".json"};this.setSort=function(field){_self.sortField=field,_self.sortReverse=!_self.sortReverse},this.calcBarSegment=function(param){return weight=null!=param.weight?param.weight:.25,param.value*weight*20+"%"},this.getCountryUrl=function(country){if(CS.countryIndex){var iso=country.iso.toLowerCase();return CS.countryIndex[iso]}return""},CS.regionId?$http.get(getRequestUrl(CS.regionId)).success(function(data){_self.countries=data.countries}):$http.get(getRequestUrl()).success(function(data){_self.countries=data})}])}();