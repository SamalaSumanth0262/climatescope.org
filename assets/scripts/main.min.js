function createCookie(name,value,days,path){path=path||"/";var expires="";if(days){var date=new Date;date.setTime(date.getTime()+24*days*60*60*1e3),expires="; expires="+date.toGMTString()}document.cookie=name+"="+value+expires+"; path="+path}function readCookie(name){for(var nameEQ=name+"=",ca=document.cookie.split(";"),i=0;i<ca.length;i++){for(var c=ca[i];" "==c.charAt(0);)c=c.substring(1,c.length);if(0===c.indexOf(nameEQ))return c.substring(nameEQ.length,c.length)}return null}function eraseCookie(name,path){path=path||"/",createCookie(name,"",-1,path)}function debounce(func,wait,immediate){var timeout;return function(){var context=this,args=arguments;clearTimeout(timeout),timeout=setTimeout(function(){timeout=null,immediate||func.apply(context,args)},wait),immediate&&!timeout&&func.apply(context,args)}}function round(value,decimals){return isNaN(value)||null===value?null:Number(Math.round(value+"e"+decimals)+"e-"+decimals)}function initDropdown(){$('[data-toggle="dropdown"]').once("dropdown").click(function(e){e.preventDefault(),e.stopPropagation();var parent=$(this).parent(".dropdown");parent.toggleClass("open"),$(".dropdown.open").not(parent).removeClass("open")}),$("body").once("dropdown",function(){$(document).click(function(){$(".dropdown.open").removeClass("open")})})}function setupCommonCountryListMethods(scope){setupCommonTableMethods(scope),scope.calcBarSegment=function(param){return weight=null!=param.weight?param.weight:.25,param.value*weight*20+"%"},scope.getCountryUrl=function(country){var iso=country.iso.toLowerCase();return scope.getTranslatedUrl("country",iso)},scope.getStateUrl=function(state){var iso=state.iso.toLowerCase();return scope.getTranslatedUrl("state",iso)},scope.toggleStates=function($event){var tbody=jQuery($event.target).closest("tbody"),statesRow=tbody.find(".country-states");statesRow.is(":hidden")?(tbody.addClass("open"),statesRow.trSlideDown()):(tbody.removeClass("open"),statesRow.trSlideUp())}}function setupCommonTableMethods(scope){scope.sortField=null,scope.sortReverse=!1,scope.sortExpression=[],scope.sortExpScoreField=null,scope.setSort=function(field){scope.sortField=field,scope.sortReverse=!scope.sortReverse},scope.setSortExpression=function(field){scope.setSort(field);var expr=scope.sortField;scope.sortReverse&&(expr="-"+expr),scope.sortExpression=[expr,scope.sortExpScoreField]},scope.checkSortClasses=function(field){return scope.sortField!=field?"sort-none":scope.sortReverse===!0?"sort-desc":"sort-asc"},scope.getTranslatedUrl=function(subject,id){switch(subject){case"country":return CS.countryIndex?CS.countryIndex[id]:"";case"state":return CS.stateIndex?CS.stateIndex[id]:"";case"parameter":return CS.parameterIndex?CS.parameterIndex[id]:"";default:return""}},scope.getTooltipContent=function(params){var t='<dl class="params-legend">';return angular.forEach(params,function(param){var className="param-"+param.id;t+='<dt class="'+className+'">',t+=param.name,t+="</dt>",t+="<dd>",t+=round(param.value,2),t+="<small>",t+=round(100*param.weight,2)+"%",t+="</small>",t+="</dd>"}),t+="</dl>"}}function setupCommonParamDetailTableMethods(scope){setupCommonTableMethods(scope),scope.getParamUrl=function(param){return scope.getTranslatedUrl("parameter",param.id)},scope.getTooltipContent=function(ind){return["<h6>"+ind.name+"</h6>","<p>"+ind.description+"</p>"].join("")}}!function(i,s,o,g,r,a,m){i.GoogleAnalyticsObject=r,i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date,a=s.createElement(o),m=s.getElementsByTagName(o)[0],a.async=1,a.src=g,m.parentNode.insertBefore(a,m)}(window,document,"script","//www.google-analytics.com/analytics.js","ga"),ga("create","UA-55540322-1","auto"),ga("send","pageview"),$(document).ready(function(){$(".data-download").click(function(e){$(this).attr("target","_blank");var url=$(this).attr("href");if("#"==url)return void e.preventDefault();var regExp=new RegExp("/([a-z-]+.csv)$"),filename=url.match(regExp)[1],label=filename+" - "+CS.lang.toUpperCase();ga("send","event","Data","Download",label)})}),function($){$.fn.trSlideUp=function(){return this.filter("tr").each(function(){var _self=$(this);_self.children("td").each(function(){0===$(this).children("div.tr-slide-wrapper").length&&$(this).wrapInner("<div class='tr-slide-wrapper'></div>"),$(this).children("div.tr-slide-wrapper").slideUp(function(){_self.hide()})})})},$.fn.trSlideDown=function(){return this.filter("tr").each(function(){var _self=$(this);_self.show(),_self.children("td").each(function(){0===$(this).children("div.tr-slide-wrapper").length&&$(this).wrapInner("<div class='tr-slide-wrapper' style='display: none'></div>"),$(this).children("div.tr-slide-wrapper").slideDown()})})}}(jQuery),$(document).ready(function(){var rank=function(){function resetSVG(){var bounds=path.bounds({type:"FeatureCollection",features:land}),topLeft=bounds[0],bottomRight=bounds[1],transform=[-topLeft[0]+50,-topLeft[1]+50];svg.attr("width",bottomRight[0]-topLeft[0]+100).attr("height",bottomRight[1]-topLeft[1]+100).style("left",topLeft[0]-50+"px").style("top",topLeft[1]-50+"px"),g.attr("transform","translate("+transform[0]+","+transform[1]+")")}function redrawMarkers(options){options.reset?(g.selectAll("g").remove(),markers.countries=drawCountries(land,""),markers.highlight=drawRanking(getSlice(visibleCountries)," highlight")):options.rankOnly&&!allRanking?(g.selectAll(".rank-marker").remove(),markers.highlight=drawRanking(getSlice(visibleCountries)," highlight")):(options.rankOnly&&allRanking||options.rankAll)&&(g.selectAll("g").remove(),markers.countries=drawRanking(land,""),markers.highlight=drawRanking(getSlice(visibleCountries)," highlight"))}function drawCountries(countries,cls){var marker=drawMarker(countries,"country-marker"+cls,5);return marker.transition().delay(700).duration(200).style("opacity",1),marker}function drawRanking(highlighted,cls){var marker=drawMarker(highlighted,"rank-marker"+cls,16);return marker.append("text").attr("dy","6px").attr("pointer-events","none").text(function(d){return d.d<10?"0"+d.d:d.d}),marker.transition().delay(function(d,i){return 200+20*i}).duration(200).style("opacity",1),marker}function drawMarker(data,cls,radius){var markers=g.selectAll("."+cls).data(data).enter().append("g").attr("class",cls).style("opacity",0).attr("transform",function(d){var coords=map.latLngToLayerPoint([d.geometry.coordinates[1],d.geometry.coordinates[0]]);return"translate("+coords.x+","+coords.y+")"});return markers.append("circle").attr("r",radius).on("mouseover",function(d){mouseState.hover=!0,clicked||showToolTip(d)}).on("mouseout",function(){mouseState.hover=!1,clicked||window.setTimeout(function(){mouseState.hover||tooltip.hide()},300)}).on("click",function(d){clicked=!0,showToolTip(d),window.setTimeout(function(){$(document).one("click",function(e){"circle"!==e.target.localName&&(clicked=!1,tooltip.hide())})},100)}),markers}function getSlice(visible){return"top-ten"===visible?land.slice(0,10):"bottom-ten"===visible?land.slice(-10):land}var indicators,mapSettings={world:{mapId:"flipside.e6958sxs",zoom:2,center:[0,0]},africa:{mapId:"flipside.cdw17lf8",zoom:3,center:[-9.6224,25.8398]},asia:{mapId:"flipside.j7e3okc6",zoom:3,center:[20.63278,104.0625]},lac:{mapId:"flipside.b1dsv657",zoom:2,center:[-15.623,-59.0625]}},mapConf=CS.regionId?mapSettings[CS.regionId]:mapSettings.world,map=L.mapbox.map("index-viz",mapConf.mapId,{minZoom:2,maxBounds:[[84.812743,-178.629215],[-78.229733,179.964543]],tileLayer:{continuousWorld:!1,noWrap:!0},scrollWheelZoom:!1}).setView(mapConf.center,mapConf.zoom),point=function(x,y){var pt=map.latLngToLayerPoint([y,x]);this.stream.point(pt.x,pt.y)},projection=d3.geo.transform({point:point}),path=d3.geo.path().projection(projection),tooltip=d3.tip().attr("class","tooltip-map top").attr("id","index-viz-tooltip").html(function(d){d=d.rank;var param_code="";$.each(d.parameters,function(index,param){var className="param-"+param.id;param_code+=['<dt class="'+className+'">'+param.name+"</dt>","<dd>",round(param.value,2),"<small>"+round(100*param.weight,2)+"%</small>","</dd>"].join(" ")});var grid_code="on"==d.grid?'<em class="label-grid label-grid-on" data-title="'+CS.t("On-grid")+'"><span>'+CS.t("On-grid")+"</span></em>":'<em class="label-grid label-grid-off" data-title="'+CS.t("Off-grid")+'"><span>'+CS.t("Off-grid")+"</span></em>";return['<article class="tooltip-inner">','<header class="tooltip__header">','<h1 class="tooltip__title"><a href="'+CS.countryIndex[d.iso]+'" title="'+CS.t("View country")+'">'+d.name+"</a></h1>",'<p class="tooltip__subtitle">'+d.region.name+"</p>",grid_code,'<a href="#" title="'+CS.t("Close")+'" class="close" onClick="return false;"><span>'+CS.t("Close")+"</span></a>","</header>",'<div class="tooltip__body">','<dl class="params-legend">',"<dt>"+CS.t("Global rank")+"</dt>","<dd>"+d.overall_ranking+"</dd>","<dt>"+CS.t("Global score")+"</dt>","<dd>"+round(d.score,2)+"</dd>",param_code,"</dl>",'<a href="'+CS.countryIndex[d.iso]+'" class="bttn bttn-cta go" title="'+CS.t("View country")+'">'+CS.t("View country")+"</a>","</div>","</article>"].join(" ")}),showToolTip=Modernizr.touch?tooltip.centerOnMouse:tooltip.centerOnTarget,$countryFilter=$("<div>",{"class":"leaflet-control bttn-group bttn-group-s bttn-list map-country-toggle"}),svg=d3.select(map.getPanes().overlayPane).append("svg:svg").call(tooltip),g=svg.append("svg:g").attr("class","leaflet-zoom-hide"),land=null,markers={highlight:[],countries:[]},countryFilter=["top-ten","bottom-ten"],countryFilterLabel={"top-ten":CS.t("Top ten"),"bottom-ten":CS.t("Bottom ten")},visibleCountries="top-ten",zoom=map.getZoom(),undef=void 0,countryListUrl=CS.domain+"/"+CS.lang+"/api/countries.json";CS.regionId&&(countryListUrl=CS.domain+"/"+CS.lang+"/api/regions/"+CS.regionId+".json");var clicked=!1,mouseState={hover:!1},allRanking=!1,allRankingLevel=3;queue().defer(d3.json,CS.domain+"/en/api/centroids.topojson").defer(d3.json,countryListUrl).await(function(error,geography,countryRank){land=topojson.feature(geography,geography.objects.centroids).features,indicators=CS.regionId?countryRank.countries:countryRank,$.each(indicators,function(index,country){country.parameters.sort(function(a,b){return a.id>b.id})});for(var iso,lookup={},max=[],filtered=[],i=0,ii=indicators.length;ii>i;++i)lookup[indicators[i].iso]=i,max.push(indicators[i].overall_ranking);for(i=0,ii=land.length;ii>i;++i)if(iso=land[i].id,lookup[iso]!==undef){land[i].rank=indicators[lookup[iso]],land[i].d=CS.regionId?land[i].rank.regional_ranking:land[i].rank.overall_ranking,land[i].parameters={};for(var k=0;4>k;++k)land[i].parameters[land[i].rank.parameters[k].id]=land[i].rank.parameters[k];filtered.push(land[i])}land=filtered.sort(function(a,b){return a.d-b.d}),resetSVG(),redrawMarkers({reset:!0}),$countryFilter.on("click","button",function(e){var cls=e.currentTarget.className,toShow=cls.slice(cls.indexOf("show")+5);visibleCountries!==toShow&&(visibleCountries=toShow,$countryFilter.find(".active").removeClass("active"),e.currentTarget.className="active "+cls,redrawMarkers({rankOnly:!0}))}),$.each(countryFilter,function(index,key){var cls="bttn bttn-default show-"+key;"top-ten"===key&&(cls="active "+cls),$("<button>",{type:"button","class":cls,text:countryFilterLabel[key]}).appendTo($countryFilter)}),$countryFilter.appendTo($(".leaflet-bottom.leaflet-left"));var $tooltip=$("#index-viz-tooltip");$tooltip.on("mouseenter",function(){mouseState.hover=!0}).on("mouseleave",function(){mouseState.hover=!1,clicked||tooltip.hide()}).on("click",".close",function(){tooltip.hide(),mouseState.hover=!1})}),map.on("dragstart",function(){tooltip.hide()}),map.on("viewreset",function(){if(resetSVG(),zoom=map.getZoom(),zoom>allRankingLevel&&!allRanking)allRanking=!0,$countryFilter.addClass("disabled"),g.selectAll(".country-marker").remove(),redrawMarkers({rankAll:!0});else if(allRankingLevel>=zoom&&allRanking)allRanking=!1,$countryFilter.removeClass("disabled"),g.selectAll(".rank-marker").remove(),redrawMarkers({reset:!0});else{var transform_func=function(d){var coords=map.latLngToLayerPoint([d.geometry.coordinates[1],d.geometry.coordinates[0]]);return"translate("+coords.x+","+coords.y+")"};for(var key in markers)markers[key].attr("transform",transform_func)}tooltip.hide()});var updateSliders=debounce(function(e,weight){if(null!==land){for(var keys=$.map(land[0].rank.parameters,function(d){return d.id}),d={},i=0,ii=land.length;ii>i;++i)d=land[i].parameters,land[i].rank.score=Math.round(weight["param-"+keys[0]]*d[keys[0]].value+weight["param-"+keys[1]]*d[keys[1]].value+weight["param-"+keys[2]]*d[keys[2]].value+weight["param-"+keys[3]]*d[keys[3]].value)/100;for(land=land.sort(function(a,b){return b.rank.score-a.rank.score}),i=0;ii>i;++i)land[i].d=land[i].rank.overall_ranking=i+1;redrawMarkers({rankOnly:!0})}},100,!1);$(".slider-group").on("update-sliders",updateSliders)},parent=document.querySelector("#index-viz");parent&&CS.gtIE8&&new rank}),$(function(){initDropdown(),createCookie("CS_lang",CS.lang,null,CS.domain)}),$(document).ready(function(){if(0!==$("#parameters-controls").length){var header_height=$("#site-header").outerHeight(),check_sticky=function(){$(document).scrollTop()>=header_height?$("#parameters-controls").hasClass("sticky")||($("#parameters-controls").addClass("sticky"),check_sticky_padding()):($("#parameters-controls").removeClass("sticky"),check_sticky_padding())},check_sticky_padding=function(){var parameter_controls=$("#parameters-controls");if("fixed"==parameter_controls.css("position")){var parameter_height=parameter_controls.outerHeight();parameter_controls.parent().css("padding-top",parameter_height)}else parameter_controls.parent().css("padding-top",0)};$(document).on("scroll",check_sticky),$(window).on("resize",debounce(function(){header_height=$("#site-header").outerHeight(),check_sticky_padding()},50)),check_sticky();var appElement=document.querySelector("[ng-app=globalApp]"),globalAppScope=angular.element(appElement).scope();$(".slider-group").sliderGroup({start:25,range:{min:0,max:100},connect:"lower",step:1,animate:!1}).on("update-sliders",function(event,data){globalAppScope.$apply(function(){var countries=globalAppScope.countryTable.countries,updateParams=function(params){var globalScore=0;return angular.forEach(params,function(param){param.weight=data["param-"+param.id]/100,globalScore+=param.weight*param.value}),round(globalScore,5)};angular.forEach(countries,function(country){var newCountryScore=updateParams(country.parameters);country.score=newCountryScore}),countries.sort(function(a,b){return b.score-a.score}),angular.forEach(countries,function(country,key){country.overall_ranking=key+1,country.states&&(angular.forEach(country.states,function(state){var newStateScore=updateParams(state.parameters);state.score=newStateScore}),country.states.sort(function(a,b){return b.score-a.score}),angular.forEach(country.states,function(state,key){state.state_ranking=key+1}))})}),$(".slider-value.param-1").text(data["param-1"]+"%"),$(".slider-value.param-2").text(data["param-2"]+"%"),$(".slider-value.param-3").text(data["param-3"]+"%"),$(".slider-value.param-4").text(data["param-4"]+"%")}),$("#vis-controls .reset").click(function(e){e.preventDefault(),$("#vis-controls.slider-group").sliderGroup("reset")})}}),$(function(){$(".browsehappy").on("click",function(){$(this).slideUp("fast")})}),function($){$(function(){$("[data-modal-id]").click(function(e){e.preventDefault();var id=$(this).attr("data-modal-id");$("#"+id).addClass("revealed")}),$(".modal").click(function(e){e.target==e.currentTarget&&$(this).removeClass("revealed")}),$("[data-modal-dismiss]").click(function(e){e.preventDefault(),$(this).closest(".modal").removeClass("revealed")})})}(jQuery),function($){function sliderGroup(options){var $group=$(this),sliders=$(".slider",$group),getGroupTotal=function(){var total=0;return sliders.each(function(){total+=parseFloat($(this).val())}),total},getSlidersData=function(){var data={};return sliders.each(function(index){var id=$(this).attr("id")||index;data[id]=parseFloat($(this).val())}),data},setSlidersDefaultValues=function(){sliders.each(function(){var starting=$(this).attr("data-starting");if(!starting)throw Error("sliderGroup: missing 'data-starting' attribute.");$(this).val($(this).attr("data-starting"))});var data=getSlidersData();$group.trigger("update-sliders",[data])};return"reset"==options?(setSlidersDefaultValues(),sliders.siblings(".lock").find(".switch-checkbox").removeAttr("checked").trigger("change"),this):(sliders.noUiSlider(options),setSlidersDefaultValues(),setTimeout(function(){var data=getSlidersData();$group.trigger("update-sliders",[data])},10),sliders.on("slide",function(){var _self=this,_selfValue=parseFloat($(this).val()),total=getGroupTotal(),delta=100-total,slidersToChange=sliders.not(_self).not("[disabled]"),countSliders=slidersToChange.length;slidersToChange.each(function(){var value=parseFloat($(this).val()),new_value=value+delta/countSliders;(0>new_value||100==_selfValue)&&(new_value=0),new_value>100&&(new_value=100),$(this).val(new_value)});var updatedTotal=getGroupTotal(),updatedOthersTotal=updatedTotal-_selfValue;100!=updatedTotal&&$(_self).val(100-updatedOthersTotal);var data=getSlidersData();$group.trigger("update-sliders",[data])}),sliders.each(function(){var $slider=$(this);$slider.siblings(".lock").find(".switch-checkbox").change(function(){$(this).is(":checked")?$slider.attr("disabled","disabled"):$slider.removeAttr("disabled")})}),this)}$.fn.sliderGroup=function(options){return this.each(function(){return sliderGroup.apply(this,[options])})}}(jQuery),angular.module("ui.bootstrap",["ui.bootstrap.tpls","ui.bootstrap.pagination","ui.bootstrap.position","ui.bootstrap.bindHtml","ui.bootstrap.tooltip","ui.bootstrap.popover"]),angular.module("ui.bootstrap.tpls",["template/pagination/pager.html","template/pagination/pagination.html","template/tooltip/tooltip-html-unsafe-popup.html","template/tooltip/tooltip-popup.html","template/popover/popover.html"]),angular.module("ui.bootstrap.pagination",[]).controller("PaginationController",["$scope","$attrs","$parse","$interpolate",function($scope,$attrs,$parse,$interpolate){var self=this,setNumPages=$attrs.numPages?$parse($attrs.numPages).assign:angular.noop;this.init=function(defaultItemsPerPage){$attrs.itemsPerPage?$scope.$parent.$watch($parse($attrs.itemsPerPage),function(value){self.itemsPerPage=parseInt(value,10),$scope.totalPages=self.calculateTotalPages()}):this.itemsPerPage=defaultItemsPerPage},this.noPrevious=function(){return 1===this.page},this.noNext=function(){return this.page===$scope.totalPages},this.isActive=function(page){return this.page===page},this.calculateTotalPages=function(){var totalPages=this.itemsPerPage<1?1:Math.ceil($scope.totalItems/this.itemsPerPage);return Math.max(totalPages||0,1)},this.getAttributeValue=function(attribute,defaultValue,interpolate){return angular.isDefined(attribute)?interpolate?$interpolate(attribute)($scope.$parent):$scope.$parent.$eval(attribute):defaultValue},this.render=function(){this.page=parseInt($scope.page,10)||1,this.page>0&&this.page<=$scope.totalPages&&($scope.pages=this.getPages(this.page,$scope.totalPages))},$scope.selectPage=function(page){!self.isActive(page)&&page>0&&page<=$scope.totalPages&&($scope.page=page,$scope.onSelectPage({page:page}))},$scope.$watch("page",function(){self.render()}),$scope.$watch("totalItems",function(){$scope.totalPages=self.calculateTotalPages()}),$scope.$watch("totalPages",function(value){setNumPages($scope.$parent,value),self.page>value?$scope.selectPage(value):self.render()})}]).constant("paginationConfig",{itemsPerPage:10,boundaryLinks:!1,directionLinks:!0,firstText:"First",previousText:"Previous",nextText:"Next",lastText:"Last",rotate:!0}).directive("pagination",["$parse","paginationConfig",function($parse,config){return{restrict:"EA",scope:{page:"=",totalItems:"=",onSelectPage:" &"},controller:"PaginationController",templateUrl:"template/pagination/pagination.html",replace:!0,link:function(scope,element,attrs,paginationCtrl){function makePage(number,text,isActive,isDisabled){return{number:number,text:text,active:isActive,disabled:isDisabled}}var maxSize,boundaryLinks=paginationCtrl.getAttributeValue(attrs.boundaryLinks,config.boundaryLinks),directionLinks=paginationCtrl.getAttributeValue(attrs.directionLinks,config.directionLinks),firstText=paginationCtrl.getAttributeValue(attrs.firstText,config.firstText,!0),previousText=paginationCtrl.getAttributeValue(attrs.previousText,config.previousText,!0),nextText=paginationCtrl.getAttributeValue(attrs.nextText,config.nextText,!0),lastText=paginationCtrl.getAttributeValue(attrs.lastText,config.lastText,!0),rotate=paginationCtrl.getAttributeValue(attrs.rotate,config.rotate);paginationCtrl.init(config.itemsPerPage),attrs.maxSize&&scope.$parent.$watch($parse(attrs.maxSize),function(value){maxSize=parseInt(value,10),paginationCtrl.render()}),paginationCtrl.getPages=function(currentPage,totalPages){var pages=[],startPage=1,endPage=totalPages,isMaxSized=angular.isDefined(maxSize)&&totalPages>maxSize;isMaxSized&&(rotate?(startPage=Math.max(currentPage-Math.floor(maxSize/2),1),endPage=startPage+maxSize-1,endPage>totalPages&&(endPage=totalPages,startPage=endPage-maxSize+1)):(startPage=(Math.ceil(currentPage/maxSize)-1)*maxSize+1,endPage=Math.min(startPage+maxSize-1,totalPages)));for(var number=startPage;endPage>=number;number++){var page=makePage(number,number,paginationCtrl.isActive(number),!1);pages.push(page)}if(isMaxSized&&!rotate){if(startPage>1){var previousPageSet=makePage(startPage-1,"...",!1,!1);pages.unshift(previousPageSet)}if(totalPages>endPage){var nextPageSet=makePage(endPage+1,"...",!1,!1);pages.push(nextPageSet)}}if(directionLinks){var previousPage=makePage(currentPage-1,previousText,!1,paginationCtrl.noPrevious());pages.unshift(previousPage);var nextPage=makePage(currentPage+1,nextText,!1,paginationCtrl.noNext());pages.push(nextPage)}if(boundaryLinks){var firstPage=makePage(1,firstText,!1,paginationCtrl.noPrevious());pages.unshift(firstPage);var lastPage=makePage(totalPages,lastText,!1,paginationCtrl.noNext());pages.push(lastPage)}return pages}}}}]).constant("pagerConfig",{itemsPerPage:10,previousText:"« Previous",nextText:"Next »",align:!0}).directive("pager",["pagerConfig",function(config){return{restrict:"EA",scope:{page:"=",totalItems:"=",onSelectPage:" &"},controller:"PaginationController",templateUrl:"template/pagination/pager.html",replace:!0,link:function(scope,element,attrs,paginationCtrl){function makePage(number,text,isDisabled,isPrevious,isNext){return{number:number,text:text,disabled:isDisabled,previous:align&&isPrevious,next:align&&isNext}}var previousText=paginationCtrl.getAttributeValue(attrs.previousText,config.previousText,!0),nextText=paginationCtrl.getAttributeValue(attrs.nextText,config.nextText,!0),align=paginationCtrl.getAttributeValue(attrs.align,config.align);paginationCtrl.init(config.itemsPerPage),paginationCtrl.getPages=function(currentPage){return[makePage(currentPage-1,previousText,paginationCtrl.noPrevious(),!0,!1),makePage(currentPage+1,nextText,paginationCtrl.noNext(),!1,!0)]}}}}]),angular.module("ui.bootstrap.position",[]).factory("$position",["$document","$window",function($document,$window){function getStyle(el,cssprop){return el.currentStyle?el.currentStyle[cssprop]:$window.getComputedStyle?$window.getComputedStyle(el)[cssprop]:el.style[cssprop]}function isStaticPositioned(element){return"static"===(getStyle(element,"position")||"static")}var parentOffsetEl=function(element){for(var docDomEl=$document[0],offsetParent=element.offsetParent||docDomEl;offsetParent&&offsetParent!==docDomEl&&isStaticPositioned(offsetParent);)offsetParent=offsetParent.offsetParent;return offsetParent||docDomEl};return{position:function(element){var elBCR=this.offset(element),offsetParentBCR={top:0,left:0},offsetParentEl=parentOffsetEl(element[0]);offsetParentEl!=$document[0]&&(offsetParentBCR=this.offset(angular.element(offsetParentEl)),offsetParentBCR.top+=offsetParentEl.clientTop-offsetParentEl.scrollTop,offsetParentBCR.left+=offsetParentEl.clientLeft-offsetParentEl.scrollLeft);var boundingClientRect=element[0].getBoundingClientRect();return{width:boundingClientRect.width||element.prop("offsetWidth"),height:boundingClientRect.height||element.prop("offsetHeight"),top:elBCR.top-offsetParentBCR.top,left:elBCR.left-offsetParentBCR.left}},offset:function(element){var boundingClientRect=element[0].getBoundingClientRect();return{width:boundingClientRect.width||element.prop("offsetWidth"),height:boundingClientRect.height||element.prop("offsetHeight"),top:boundingClientRect.top+($window.pageYOffset||$document[0].body.scrollTop||$document[0].documentElement.scrollTop),left:boundingClientRect.left+($window.pageXOffset||$document[0].body.scrollLeft||$document[0].documentElement.scrollLeft)}}}}]),angular.module("ui.bootstrap.bindHtml",[]).directive("bindHtmlUnsafe",function(){return function(scope,element,attr){element.addClass("ng-binding").data("$binding",attr.bindHtmlUnsafe),scope.$watch(attr.bindHtmlUnsafe,function(value){element.html(value||"")})}}),angular.module("ui.bootstrap.tooltip",["ui.bootstrap.position","ui.bootstrap.bindHtml"]).provider("$tooltip",function(){function snake_case(name){var regexp=/[A-Z]/g,separator="-";return name.replace(regexp,function(letter,pos){return(pos?separator:"")+letter.toLowerCase()})}var defaultOptions={placement:"top",animation:!0,popupDelay:0},triggerMap={mouseenter:"mouseleave",click:"click",focus:"blur"},globalOptions={};this.options=function(value){angular.extend(globalOptions,value)},this.setTriggers=function(triggers){angular.extend(triggerMap,triggers)},this.$get=["$window","$compile","$timeout","$parse","$document","$position","$interpolate",function($window,$compile,$timeout,$parse,$document,$position,$interpolate){return function(type,prefix,defaultTriggerShow){function getTriggers(trigger){var show=trigger||options.trigger||defaultTriggerShow,hide=triggerMap[show]||show;return{show:show,hide:hide}}var options=angular.extend({},defaultOptions,globalOptions),directiveName=snake_case(type),startSym=$interpolate.startSymbol(),endSym=$interpolate.endSymbol(),template="<div "+directiveName+'-popup title="'+startSym+"tt_title"+endSym+'" content="'+startSym+"tt_content"+endSym+'" placement="'+startSym+"tt_placement"+endSym+'" animation="tt_animation" is-open="tt_isOpen"></div>';return{restrict:"EA",scope:!0,compile:function(){var tooltipLinker=$compile(template);return function(scope,element,attrs){function toggleTooltipBind(){scope.tt_isOpen?hideTooltipBind():showTooltipBind()}function showTooltipBind(){(!hasEnableExp||scope.$eval(attrs[prefix+"Enable"]))&&(scope.tt_popupDelay?(popupTimeout=$timeout(show,scope.tt_popupDelay,!1),popupTimeout.then(function(reposition){reposition()})):show()())}function hideTooltipBind(){scope.$apply(function(){hide()})}function show(){return scope.tt_content?(createTooltip(),transitionTimeout&&$timeout.cancel(transitionTimeout),tooltip.css({top:0,left:0,display:"block"}),appendToBody?$document.find("body").append(tooltip):element.after(tooltip),positionTooltip(),scope.tt_isOpen=!0,scope.$digest(),positionTooltip):angular.noop}function hide(){scope.tt_isOpen=!1,$timeout.cancel(popupTimeout),scope.tt_animation?transitionTimeout=$timeout(removeTooltip,500):removeTooltip()}function createTooltip(){tooltip&&removeTooltip(),tooltip=tooltipLinker(scope,function(){}),scope.$digest()}function removeTooltip(){tooltip&&(tooltip.remove(),tooltip=null)}var tooltip,transitionTimeout,popupTimeout,appendToBody=angular.isDefined(options.appendToBody)?options.appendToBody:!1,triggers=getTriggers(void 0),hasRegisteredTriggers=!1,hasEnableExp=angular.isDefined(attrs[prefix+"Enable"]),positionTooltip=function(){var position,ttWidth,ttHeight,ttPosition;switch(position=appendToBody?$position.offset(element):$position.position(element),ttWidth=tooltip.prop("offsetWidth"),ttHeight=tooltip.prop("offsetHeight"),scope.tt_placement){case"right":ttPosition={top:position.top+position.height/2-ttHeight/2,left:position.left+position.width};break;case"bottom":ttPosition={top:position.top+position.height,left:position.left+position.width/2-ttWidth/2};break;case"left":ttPosition={top:position.top+position.height/2-ttHeight/2,left:position.left-ttWidth};break;default:ttPosition={top:position.top-ttHeight,left:position.left+position.width/2-ttWidth/2}}ttPosition.top+="px",ttPosition.left+="px",tooltip.css(ttPosition)};scope.tt_isOpen=!1,attrs.$observe(type,function(val){scope.tt_content=val,!val&&scope.tt_isOpen&&hide()}),attrs.$observe(prefix+"Title",function(val){scope.tt_title=val}),attrs.$observe(prefix+"Placement",function(val){scope.tt_placement=angular.isDefined(val)?val:options.placement}),attrs.$observe(prefix+"PopupDelay",function(val){var delay=parseInt(val,10);scope.tt_popupDelay=isNaN(delay)?options.popupDelay:delay});var unregisterTriggers=function(){hasRegisteredTriggers&&(element.unbind(triggers.show,showTooltipBind),element.unbind(triggers.hide,hideTooltipBind))};attrs.$observe(prefix+"Trigger",function(val){unregisterTriggers(),triggers=getTriggers(val),triggers.show===triggers.hide?element.bind(triggers.show,toggleTooltipBind):(element.bind(triggers.show,showTooltipBind),element.bind(triggers.hide,hideTooltipBind)),hasRegisteredTriggers=!0});var animation=scope.$eval(attrs[prefix+"Animation"]);scope.tt_animation=angular.isDefined(animation)?!!animation:options.animation,attrs.$observe(prefix+"AppendToBody",function(val){appendToBody=angular.isDefined(val)?$parse(val)(scope):appendToBody}),appendToBody&&scope.$on("$locationChangeSuccess",function(){scope.tt_isOpen&&hide()}),scope.$on("$destroy",function(){$timeout.cancel(transitionTimeout),$timeout.cancel(popupTimeout),unregisterTriggers(),removeTooltip()})}}}}}]}).directive("tooltipPopup",function(){return{restrict:"EA",replace:!0,scope:{content:"@",placement:"@",animation:"&",isOpen:"&"},templateUrl:"template/tooltip/tooltip-popup.html"}}).directive("tooltip",["$tooltip",function($tooltip){return $tooltip("tooltip","tooltip","mouseenter")}]).directive("tooltipHtmlUnsafePopup",function(){return{restrict:"EA",replace:!0,scope:{content:"@",placement:"@",animation:"&",isOpen:"&"},templateUrl:"template/tooltip/tooltip-html-unsafe-popup.html"}}).directive("tooltipHtmlUnsafe",["$tooltip",function($tooltip){return $tooltip("tooltipHtmlUnsafe","tooltip","mouseenter")}]),angular.module("ui.bootstrap.popover",["ui.bootstrap.tooltip"]).directive("popoverPopup",function(){return{restrict:"EA",replace:!0,scope:{title:"@",content:"@",placement:"@",animation:"&",isOpen:"&"},templateUrl:"template/popover/popover.html"}}).directive("popover",["$tooltip",function($tooltip){return $tooltip("popover","popover","click")}]),angular.module("template/pagination/pager.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("template/pagination/pager.html",'<ul class="pager">\n  <li ng-repeat="page in pages" ng-class="{disabled: page.disabled, previous: page.previous, next: page.next}"><a ng-click="selectPage(page.number)">{{page.text}}</a></li>\n</ul>')}]),angular.module("template/pagination/pagination.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("template/pagination/pagination.html",'<ul class="pagination">\n  <li ng-repeat="page in pages" ng-class="{active: page.active, disabled: page.disabled}"><a ng-click="selectPage(page.number)">{{page.text}}</a></li>\n</ul>')}]),angular.module("template/tooltip/tooltip-html-unsafe-popup.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("template/tooltip/tooltip-html-unsafe-popup.html",'<div class="tooltip {{placement}}" ng-class="{ in: isOpen(), fade: animation() }">\n  <div class="tooltip-arrow"></div>\n  <div class="tooltip-inner" bind-html-unsafe="content"></div>\n</div>\n')}]),angular.module("template/tooltip/tooltip-popup.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("template/tooltip/tooltip-popup.html",'<div class="tooltip {{placement}}" ng-class="{ in: isOpen(), fade: animation() }">\n  <div class="tooltip-arrow"></div>\n  <div class="tooltip-inner" ng-bind="content"></div>\n</div>\n')
}]),angular.module("template/popover/popover.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("template/popover/popover.html",'<div class="popover {{placement}}" ng-class="{ in: isOpen(), fade: animation() }">\n  <div class="arrow"></div>\n\n  <div class="popover-inner">\n      <h3 class="popover-title" ng-bind="title" ng-show="title"></h3>\n      <div class="popover-content" ng-bind="content"></div>\n  </div>\n</div>\n')}]),function(){var app=angular.module("countryApp",["ngRoute","countryAppControllers","ui.bootstrap","mathFilters"],function($interpolateProvider){$interpolateProvider.startSymbol("%%"),$interpolateProvider.endSymbol("%%")});app.config(["$routeProvider",function($routeProvider){$routeProvider.when("/details",{templateUrl:"in_detail.html",controller:"DetailsTabController",controllerAs:"detailsCtrl",activeTab:"details"}).when("/states",{templateUrl:"states.html",controller:"StatesTabController",controllerAs:"statesCtrl",activeTab:"states"}).otherwise({redirectTo:"/details"})}]),app.factory("CountryData",["$http",function($http){var cache;return this.get=function(cb){if(cache)cb(cache);else{var url=CS.domain+"/"+CS.lang+"/api/countries/"+CS.countryId+".json";$http.get(url).success(function(data){cache=data,cb(data)})}},this}]);var countryAppControllers=angular.module("countryAppControllers",[]);countryAppControllers.controller("StatsController",["$http","CountryData",function($http,CountryData){var _self=this;this.policyCount=0,this.countryStats={};var url=CS.policyProxy+"/policy?limit=1&country="+CS.countryId.toUpperCase();$http.get(url).success(function(data){_self.policyCount=data.metaData.totalResults}),CountryData.get(function(data){_self.countryStats=data.score[0]})}]),countryAppControllers.controller("CountryTabsController",["$http","$route",function($http,$route){this.isActive=function(name){return $route.current?$route.current.activeTab==name:!1}}]),countryAppControllers.controller("DetailsTabController",["$http","$route","CountryData",function($http,$route,CountryData){var _self=this;this.parameters=[],setupCommonParamDetailTableMethods(_self),CountryData.get(function(data){_self.parameters=data.parameters})}]),countryAppControllers.controller("StatesTabController",["$http","$route","$location","CountryData",function($http,$route,$location,CountryData){var _self=this;this.states=[],CS.countryHasStates||$location.path("/details"),setupCommonCountryListMethods(_self),this.setSort("score"),CountryData.get(function(data){_self.states=data.states})}]),countryAppControllers.controller("CaseStudyTabController",["$http","$route",function(){}])}(),function(){var app=angular.module("globalApp",["ui.bootstrap","mathFilters"],function($interpolateProvider){$interpolateProvider.startSymbol("%%"),$interpolateProvider.endSymbol("%%")});app.controller("CountryListController",["$http",function($http){var _self=this;this.countries=[],this.rankingField="overall_ranking",setupCommonCountryListMethods(_self),this.sortExpScoreField="-score",this.setSortExpression("score");var url=CS.domain+"/"+CS.lang+"/api/countries.json";$http.get(url).success(function(data){_self.countries=data})}])}(),function(){var app=angular.module("parameterApp",["mathFilters","ui.bootstrap"],function($interpolateProvider){$interpolateProvider.startSymbol("%%"),$interpolateProvider.endSymbol("%%")});app.controller("CountryListController",["$http",function($http){var _self=this;this.parameter={},this.countries=[],this.scoreAvg=0,setupCommonCountryListMethods(_self),this.sortExpScoreField="-data[0].value",this.setSortExpression("data[0].value");var calcAvgScore=function(){var score=0;angular.forEach(_self.countries,function(country){score+=country.data[0].value}),_self.scoreAvg=score/_self.countries.length},getTooltipContent_orig=this.getTooltipContent;this.getTooltipContent=function(data){var param={id:_self.parameter.id,name:_self.parameter.name,value:data.value,weight:_self.parameter.weight};return getTooltipContent_orig([param])};var url=CS.domain+"/"+CS.lang+"/api/parameters/"+CS.parameterId+".json";$http.get(url).success(function(data){_self.parameter=data,_self.countries=data.countries,calcAvgScore()})}]),app.controller("StatsController",["$http","$filter",function($http,$filter){var _self=this;this.paramStats=[];var url=CS.domain+"/"+CS.lang+"/api/stats.json";$http.get(url).success(function(data){angular.forEach(data.regions,function(region){region.parameters=$filter("filter")(region.parameters,function(value){return value.id==CS.parameterId})}),_self.regionStats=data.regions})}])}(),function(){var objToArray=function(obj){var arr=[];return angular.forEach(obj,function(value){arr.push(value)}),arr},updateLangSwitcherUrl=function(new_url){$(".lang-menu a").each(function(){var url;$(this).data("orig_href")?url=$(this).data("orig_href"):(url=$(this).attr("href"),$(this).data("orig_href",url)),url+="#"+new_url,$(this).attr("href",url)})},app=angular.module("policyApp",["ngRoute","ui.bootstrap"],function($interpolateProvider){$interpolateProvider.startSymbol("%%"),$interpolateProvider.endSymbol("%%")});app.filter("nl2br",["$sce",function($sce){return function(msg,is_xhtml){if(!msg||null===msg)return null;var is_xhtml=is_xhtml||!0,breakTag=is_xhtml?"<br />":"<br>",msg=(msg+"").replace(/([^>\r\n]?)(\r\n|\n\r|\r|\n)/g,"$1"+breakTag+"$2");return $sce.trustAsHtml(msg)}}]),app.config(["$routeProvider",function($routeProvider){$routeProvider.when("/",{templateUrl:"policy_list.html",controller:"policyListController",controllerAs:"policyListCtrl",reloadOnSearch:!1}).when("/policy/:policyId",{templateUrl:"policy.html",controller:"policyController",controllerAs:"policyCtrl"}).otherwise({redirectTo:"/"})}]),app.directive("initDropdown",function(){return{restrict:"AE",link:function(){initDropdown()}}}),app.factory("queryStringData",["$location",function($location){var _self=this;if(this.filters={country:null,status:null,state:null},this.pagination={page:null},this.sort={"sort-on":"name","sort-direction":"asc"},this.disableFilters=function(){for(var key in _self.filters)_self.filters[key]=null;_self.update()},this.areFiltersEnabled=function(){var control=!1;return angular.forEach(_self.filters,function(value){null!=value&&(control=!0)}),control},this.setSort=function(field){_self.sort["sort-on"]=field,_self.sort["sort-direction"]="asc"==_self.sort["sort-direction"]?"desc":"asc",_self.update()},this.update=function(){var queryString={};angular.extend(queryString,_self.filters,_self.pagination,_self.sort),$location.search(queryString)},!angular.equals({},$location.search())){updateLangSwitcherUrl($location.url());var data=$location.search();for(var key in _self.filters)_self.filters[key]=data[key]||null;_self.filters.status&&(_self.filters.status=parseInt(_self.filters.status));for(var key in _self.pagination)_self.pagination[key]=data[key]||null;for(var key in _self.sort)_self.sort[key]=data[key]||null}return this}]),app.controller("policyListController",function(){}),app.controller("policyFiltersController",["$http","$filter","$rootScope","$scope","$location","queryStringData",function($http,$filter,$rootScope,$scope,$location,queryStringData){var _self=this;this.filterData={},this.filters=queryStringData.filters,this.filtersEnabled=queryStringData.areFiltersEnabled(),this.getSelectOpts=function(field){var data=objToArray(field);return $filter("orderBy")(data,"name")},this.getSelectOptsState=function(field){var data=objToArray(field),filtered=$filter("filter")(data,{countryId:_self.filters.country||null});return $filter("orderBy")(filtered,"name")},this.disableFilters=function(){_self.filtersEnabled&&(_self.filtersEnabled=!1,queryStringData.disableFilters(),$rootScope.$broadcast("apply-filters",_self.filters))},this.apply=function(){_self.filtersEnabled=queryStringData.areFiltersEnabled(),queryStringData.update(),$rootScope.$broadcast("apply-filters",_self.filters)},$http.get(CS.policyProxy+"/policy/filter").success(function(data){_self.filterData=data}),$rootScope.$on("$locationChangeSuccess",function(){$scope.currentPath=$location.url(),updateLangSwitcherUrl($location.url())})}]),app.controller("policyTableController",["$http","$scope","$location","$templateCache","queryStringData",function($http,$scope,$location,$templateCache,queryStringData){var _self=this;$templateCache.put("template/pagination/pagination.html","<div class='pagination-wrapper'>\n  <ul class='pagination bttn-group bttn-group-m bttn-list'>\n    <li ng-repeat='page in pages'><a class='bttn bttn-default' ng-class='{active: page.active, disabled: page.disabled}' ng-click='selectPage(page.number)'>{{page.text}}</a></li>\n  </ul>\n</div>"),this.filters=queryStringData.filters,this.sort=queryStringData.sort,this.policies={},this.loadingData=!0,this.currentPage=queryStringData.pagination.page||1,this.totalItems=0,this.itemsPerPage=50,this.pagesToShow=5,this.sort=queryStringData.sort,this.setSort=function(field){queryStringData.setSort(field),getPolicies()},this.checkSortClasses=function(field){return _self.sort["sort-on"]!=field?"sort-none":"desc"==_self.sort["sort-direction"]?"sort-desc":"sort-asc"},this.getPolicyLink=function(policy){return"#/policy/"+policy.id},this.getTooltipContentList=function(list){var data=[];for(var i in list)0!=i&&data.push(list[i].name);return data.join(", ")},this.changePage=function(page){_self.currentPage=page,queryStringData.pagination.page=page,queryStringData.update(),getPolicies()};var getPolicies=function(){_self.loadingData=!0;var queryString=[];queryString.push("limit="+_self.itemsPerPage),queryString.push("offset="+(_self.currentPage-1)*_self.itemsPerPage),angular.forEach(_self.filters,function(value,key){null!==value&&queryString.push(key+"="+value)}),angular.forEach(_self.sort,function(value,key){null!==value&&queryString.push(key+"="+value)}),queryString=queryString.length?"?"+queryString.join("&"):"",$http.get(CS.policyProxy+"/policy"+queryString).success(function(data){_self.policies=data.listData,_self.totalItems=data.metaData.totalResults,_self.loadingData=!1})};$scope.$on("apply-filters",function(){_self.loadingData=!0,getPolicies()}),getPolicies()}]),app.controller("policyController",["$http","$routeParams","$location","$scope",function($http,$routeParams,$location,$scope){$scope.currentPath=$location.url(),updateLangSwitcherUrl($location.url());var _self=this;this.policy={},this.loadingData=!0,$http.get(CS.policyProxy+"/policy/"+$routeParams.policyId).success(function(data){_self.policy=data,_self.loadingData=!1})}])}(),function(){var app=angular.module("regionApp",["ui.bootstrap","mathFilters"],function($interpolateProvider){$interpolateProvider.startSymbol("%%"),$interpolateProvider.endSymbol("%%")});app.controller("CountryListController",["$http",function($http){var _self=this;this.countries=[],this.rankingField="regional_ranking",setupCommonCountryListMethods(_self),this.sortExpScoreField="-score",this.setSortExpression("score");var url=CS.domain+"/"+CS.lang+"/api/regions/"+CS.regionId+".json";$http.get(url).success(function(data){_self.countries=data.countries})}]),app.controller("StatsController",["$http",function($http){var _self=this;this.regionStats=[];var url=CS.domain+"/"+CS.lang+"/api/stats.json";$http.get(url).success(function(data){_self.regionStats=data.regions})}])}(),function(){var app=angular.module("stateApp",["ui.bootstrap","mathFilters"],function($interpolateProvider){$interpolateProvider.startSymbol("%%"),$interpolateProvider.endSymbol("%%")});app.controller("DetailsController",["$http",function($http){var _self=this;this.parameters=[],setupCommonParamDetailTableMethods(_self);var url=CS.domain+"/"+CS.lang+"/api/countries/"+CS.stateId+".json";$http.get(url).success(function(data){_self.parameters=data.parameters})}]),app.controller("StatsController",["$http",function($http){var _self=this;this.policyCount=0,this.stateStats={};var url=CS.policyProxy+"/policy?limit=1&state="+CS.stateId.toUpperCase();$http.get(url).success(function(data){_self.policyCount=data.metaData.totalResults});var url=CS.domain+"/"+CS.lang+"/api/countries/"+CS.stateId+".json";$http.get(url).success(function(data){_self.stateStats=data.score[0]})}])}(),function(){var mathFilters=angular.module("mathFilters",[]);mathFilters.filter("round",function(){return function(input,precision){return round(input,precision)}}),mathFilters.filter("leadingZero",function(){return function(input,digits){if(isNaN(input)||null===input)return null;var count=input.toString().length;if(digits>count)for(var total=digits-count,i=0;total>i;i++)input="0"+input;return input}})}(),function(a){function q(d){return"number"==typeof d&&!isNaN(d)&&isFinite(d)}function s(d,g){return 100*g/(d[1]-d[0])}function p(d,g){for(var e=1;d>=g[e];)e+=1;return e}function k(d,g,e,a){this.xPct=[],this.xVal=[],this.xSteps=[a||!1],this.xNumSteps=[!1],this.snap=g,this.direction=e;for(var f in d)if(d.hasOwnProperty(f)){if(g=f,e=d[f],a=void 0,"number"==typeof e&&(e=[e]),"[object Array]"!==Object.prototype.toString.call(e))throw Error("noUiSlider: 'range' contains invalid value.");if(a="min"===g?0:"max"===g?100:parseFloat(g),!q(a)||!q(e[0]))throw Error("noUiSlider: 'range' value isn't numeric.");this.xPct.push(a),this.xVal.push(e[0]),a?this.xSteps.push(isNaN(e[1])?!1:e[1]):isNaN(e[1])||(this.xSteps[0]=e[1])}this.xNumSteps=this.xSteps.slice(0);for(f in this.xNumSteps)this.xNumSteps.hasOwnProperty(f)&&(d=Number(f),(g=this.xNumSteps[f])&&(this.xSteps[d]=s([this.xVal[d],this.xVal[d+1]],g)/(100/(this.xPct[d+1]-this.xPct[d]))))}k.prototype.getMargin=function(d){return 2===this.xPct.length?s(this.xVal,d):!1},k.prototype.toStepping=function(d){var g=this.xVal,a=this.xPct;if(d>=g.slice(-1)[0])d=100;else{var f,k,m=p(d,g);f=g[m-1],k=g[m],g=a[m-1],a=a[m],f=[f,k],d=s(f,0>f[0]?d+Math.abs(f[0]):d-f[0]),d=g+d/(100/(a-g))}return this.direction&&(d=100-d),d},k.prototype.fromStepping=function(d){this.direction&&(d=100-d);var a,e=this.xVal;if(a=this.xPct,d>=100)a=e.slice(-1)[0];else{var f,k,m=p(d,a);f=e[m-1],k=e[m],e=a[m-1],f=[f,k],a=100/(a[m]-e)*(d-e)*(f[1]-f[0])/100+f[0]}return d=Math.pow(10,7),Number((Math.round(a*d)/d).toFixed(7))},k.prototype.getStep=function(d){this.direction&&(d=100-d);var a=this.xPct,e=this.xSteps,k=this.snap;if(100!==d){var f=p(d,a);k?(e=a[f-1],a=a[f],d=d-e>(a-e)/2?a:e):(e[f-1]?(k=a[f-1],e=e[f-1],a=Math.round((d-a[f-1])/e)*e,a=k+a):a=d,d=a)}return this.direction&&(d=100-d),d},k.prototype.getApplicableStep=function(a){var g=p(a,this.xPct);return a=100===a?2:1,[this.xNumSteps[g-2],this.xVal[g-a],this.xNumSteps[g-a]]},k.prototype.convert=function(a){return this.getStep(this.toStepping(a))},a.noUiSlider={Spectrum:k}}(window.jQuery||window.Zepto),function(a){function q(c){return"number"==typeof c&&!isNaN(c)&&isFinite(c)}function s(c,b){if(!q(b))throw Error("noUiSlider: 'step' is not numeric.");c.singleStep=b}function p(c,b){if("object"!=typeof b||a.isArray(b))throw Error("noUiSlider: 'range' is not an object.");if(void 0===b.min||void 0===b.max)throw Error("noUiSlider: Missing 'min' or 'max' in 'range'.");c.spectrum=new a.noUiSlider.Spectrum(b,c.snap,c.dir,c.singleStep)}function k(c,b){var d=b;if(b=a.isArray(d)?d:[d],!a.isArray(b)||!b.length||2<b.length)throw Error("noUiSlider: 'start' option is incorrect.");c.handles=b.length,c.start=b}function d(c,b){if(c.snap=b,"boolean"!=typeof b)throw Error("noUiSlider: 'snap' option must be a boolean.")}function g(c,b){if(c.animate=b,"boolean"!=typeof b)throw Error("noUiSlider: 'animate' option must be a boolean.")}function e(c,b){if("lower"===b&&1===c.handles)c.connect=1;else if("upper"===b&&1===c.handles)c.connect=2;else if(!0===b&&2===c.handles)c.connect=3;else{if(!1!==b)throw Error("noUiSlider: 'connect' option doesn't match handle count.");c.connect=0}}function m(c,b){switch(b){case"horizontal":c.ort=0;break;case"vertical":c.ort=1;break;default:throw Error("noUiSlider: 'orientation' option is invalid.")}}function f(c,b){if(!q(b))throw Error("noUiSlider: 'margin' option must be numeric.");if(c.margin=c.spectrum.getMargin(b),!c.margin)throw Error("noUiSlider: 'margin' option is only supported on linear sliders.")}function x(c,b){if(!q(b))throw Error("noUiSlider: 'limit' option must be numeric.");if(c.limit=c.spectrum.getMargin(b),!c.limit)throw Error("noUiSlider: 'limit' option is only supported on linear sliders.")}function y(c,b){switch(b){case"ltr":c.dir=0;break;case"rtl":c.dir=1,c.connect=[0,2,1,3][c.connect];break;default:throw Error("noUiSlider: 'direction' option was not recognized.")}}function t(c,b){if("string"!=typeof b)throw Error("noUiSlider: 'behaviour' must be a string containing options.");var a=0<=b.indexOf("tap"),d=0<=b.indexOf("drag"),e=0<=b.indexOf("fixed"),f=0<=b.indexOf("snap");c.events={tap:a||f,drag:d,fixed:e,snap:f}}function u(c,b){if(c.format=b,"function"==typeof b.to&&"function"==typeof b.from)return!0;throw Error("noUiSlider: 'format' requires 'to' and 'from' methods.")}var h={to:function(c){return c.toFixed(2)},from:Number};a.noUiSlider.testOptions=function(c){var G,b={margin:0,limit:0,animate:!0,format:h};return G={step:{r:!1,t:s},start:{r:!0,t:k},connect:{r:!0,t:e},direction:{r:!0,t:y},snap:{r:!1,t:d},animate:{r:!1,t:g},range:{r:!0,t:p},orientation:{r:!1,t:m},margin:{r:!1,t:f},limit:{r:!1,t:x},behaviour:{r:!0,t:t},format:{r:!1,t:u}},c=a.extend({connect:!1,direction:"ltr",behaviour:"tap",orientation:"horizontal"},c),a.each(G,function(a,d){if(void 0===c[a]){if(d.r)throw Error("noUiSlider: '"+a+"' is required.");return!0}d.t(b,c[a])}),b.style=b.ort?"top":"left",b}}(window.jQuery||window.Zepto),function(a){function q(c){return Math.max(Math.min(c,100),0)}function s(c,b,a){c.addClass(b),setTimeout(function(){c.removeClass(b)},a)}function p(c,b){var d=a("<div><div/></div>").addClass(h[2]),e=["-lower","-upper"];return c&&e.reverse(),d.children().addClass(h[3]+" "+h[3]+e[b]),d}function k(a,b,d){switch(a){case 1:b.addClass(h[7]),d[0].addClass(h[6]);break;case 3:d[1].addClass(h[6]);case 2:d[0].addClass(h[7]);case 0:b.addClass(h[6])}}function d(a,b,d){var e,f=[];for(e=0;a>e;e+=1)f.push(p(b,e).appendTo(d));return f}function g(c,b,d){return d.addClass([h[0],h[8+c],h[4+b]].join(" ")),a("<div/>").appendTo(d).addClass(h[1])}function e(c,b,e){function f(){return v[["width","height"][b.ort]]()}function m(b){var a,c=[n.val()];for(a=0;a<b.length;a+=1)n.trigger(b[a],c)}function p(a){return 1===a.length?a[0]:b.dir?a.reverse():a}function x(b){return function(a,c){n.val([b?null:c,b?c:null],!0)}}function t(b){var c=a.inArray(b,w);n[0].linkAPI&&n[0].linkAPI[b]&&n[0].linkAPI[b].change(B[c],l[c].children(),n)}function C(a,c,d){var e=a[0]!==l[0][0]?1:0,H=r[0]+b.margin,f=r[1]-b.margin,g=r[0]+b.limit,k=r[1]-b.limit;return 1<l.length&&(c=e?Math.max(c,H):Math.min(c,f)),!1!==d&&b.limit&&1<l.length&&(c=e?Math.min(c,g):Math.max(c,k)),c=z.getStep(c),c=q(parseFloat(c.toFixed(7))),c===r[e]?!1:(a.css(b.style,c+"%"),a.is(":first-child")&&a.toggleClass(h[17],c>50),r[e]=c,B[e]=z.fromStepping(c),t(w[e]),!0)}function A(a,c,d,e){return a=a.replace(/\s/g,".nui ")+".nui",c.on(a,function(a){if(n.attr("disabled")||n.hasClass(h[14]))return!1;a.preventDefault();var D,g,c=0===a.type.indexOf("touch"),f=0===a.type.indexOf("mouse"),E=0===a.type.indexOf("pointer"),k=a;0===a.type.indexOf("MSPointer")&&(E=!0),a.originalEvent&&(a=a.originalEvent),c&&(D=a.changedTouches[0].pageX,g=a.changedTouches[0].pageY),(f||E)&&(E||void 0!==window.pageXOffset||(window.pageXOffset=document.documentElement.scrollLeft,window.pageYOffset=document.documentElement.scrollTop),D=a.clientX+window.pageXOffset,g=a.clientY+window.pageYOffset),k.points=[D,g],k.cursor=f,a=k,a.calcPoint=a.points[b.ort],d(a,e)})}function I(a,b){var d,c=b.handles||l,e=!1,e=100*(a.calcPoint-b.start)/f(),g=c[0][0]!==l[0][0]?1:0,h=b.positions;d=e+h[0],e+=h[1],1<c.length?(0>d&&(e+=Math.abs(d)),e>100&&(d-=e-100),d=[q(d),q(e)]):d=[d,e],e=C(c[0],d[g],1===c.length),1<c.length&&(e=C(c[1],d[g?0:1],!1)||e),e&&m(["slide"])}function J(b){a("."+h[15]).removeClass(h[15]),b.cursor&&a("body").css("cursor","").off(".nui"),y.off(".nui"),n.removeClass(h[12]),m(["set","change"])}function F(b,c){1===c.handles.length&&c.handles[0].children().addClass(h[15]),b.stopPropagation(),A(u.move,y,I,{start:b.calcPoint,handles:c.handles,positions:[r[0],r[l.length-1]]}),A(u.end,y,J,null),b.cursor&&(a("body").css("cursor",a(b.target).css("cursor")),1<l.length&&n.addClass(h[12]),a("body").on("selectstart.nui",!1))}function K(c){var d=c.calcPoint,e=0;c.stopPropagation(),a.each(l,function(){e+=this.offset()[b.style]}),e=e/2>d||1===l.length?0:1,d-=v.offset()[b.style],d=100*d/f(),b.events.snap||s(n,h[14],300),C(l[e],d),m(["slide","set","change"]),b.events.snap&&F(c,{handles:[l[e]]})}var v,l,n=a(c),r=[-1,-1],z=b.spectrum,B=[],w=["lower","upper"].slice(0,b.handles);if(b.dir&&w.reverse(),c.LinkUpdate=t,c.LinkConfirm=function(c,d){var e=a.inArray(c,w);return d&&d.appendTo(l[e].children()),b.dir&&(e=1===e?0:1),x(e)},c.LinkDefaultFormatter=b.format,c.LinkDefaultFlag="lower",c.reappend=function(){var a,b;for(a=0;a<w.length;a+=1)this.linkAPI&&this.linkAPI[b=w[a]]&&this.linkAPI[b].reconfirm(b)},n.hasClass(h[0]))throw Error("Slider was already initialized.");v=g(b.dir,b.ort,n),l=d(b.handles,b.dir,v),k(b.connect,n,l),function(a){var b;if(!a.fixed)for(b=0;b<l.length;b+=1)A(u.start,l[b].children(),F,{handles:[l[b]]});a.tap&&A(u.start,v,K,{handles:l}),a.drag&&(b=v.find("."+h[7]).addClass(h[10]),a.fixed&&(b=b.add(v.children().not(b).children())),A(u.start,b,F,{handles:l}))}(b.events),c.vSet=function(c){if(n[0].LinkIsEmitting)return this;var d;c=a.isArray(c)?c:[c],b.dir&&1<b.handles&&c.reverse(),b.animate&&-1!==r[0]&&s(n,h[14],300),d=1<l.length?3:1,1===c.length&&(d=1);var e,f,g;for(b.limit&&(d+=1),e=0;d>e;e+=1)f=e%2,g=c[f],null!==g&&!1!==g&&("number"==typeof g&&(g=String(g)),g=b.format.from(g),(!1===g||isNaN(g)||!1===C(l[f],z.toStepping(g),e===3-b.dir))&&t(w[f]));return m(["set"]),this},c.vGet=function(){var a,c=[];for(a=0;a<b.handles;a+=1)c[a]=b.format.to(B[a]);return p(c)},c.destroy=function(){return a(this).off(".nui").removeClass(h.join(" ")).empty(),delete this.LinkUpdate,delete this.LinkConfirm,delete this.LinkDefaultFormatter,delete this.LinkDefaultFlag,delete this.reappend,delete this.vGet,delete this.vSet,delete this.getCurrentStep,delete this.getInfo,delete this.destroy,e},c.getCurrentStep=function(){var b=a.map(r,function(a,b){var c=z.getApplicableStep(a);return[[B[b]-c[2]>=c[1]?c[2]:c[0],c[2]]]});return p(b)},c.getInfo=function(){return[z,b.style,b.ort]},n.val(b.start)}function m(c){if(!this.length)throw Error("noUiSlider: Can't initialize slider on empty selection.");var b=a.noUiSlider.testOptions(c,this);return this.each(function(){e(this,b,c)})}function f(c){return this.each(function(){if(this.destroy){var b=a(this).val(),d=this.destroy(),e=a.extend({},d,c);a(this).noUiSlider(e),this.reappend(),d.start===e.start&&a(this).val(b)}else a(this).noUiSlider(c)})}function x(){return this[0][arguments.length?"vSet":"vGet"].apply(this[0],arguments)}var y=a(document),t=a.fn.val,u=window.navigator.pointerEnabled?{start:"pointerdown",move:"pointermove",end:"pointerup"}:window.navigator.msPointerEnabled?{start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}:{start:"mousedown touchstart",move:"mousemove touchmove",end:"mouseup touchend"},h="noUi-target noUi-base noUi-origin noUi-handle noUi-horizontal noUi-vertical noUi-background noUi-connect noUi-ltr noUi-rtl noUi-dragable  noUi-state-drag  noUi-state-tap noUi-active  noUi-stacking".split(" ");a.fn.val=function(){var c=arguments,b=a(this[0]);return arguments.length?this.each(function(){(a(this).hasClass(h[0])?x:t).apply(a(this),c)}):(b.hasClass(h[0])?x:t).call(b)},a.fn.noUiSlider=function(a,b){return(b?f:m).call(this,a)}}(window.jQuery||window.Zepto),function(e){"use strict";"object"==typeof exports?e(require("jquery")):"function"==typeof define&&define.amd?define(["jquery"],e):e(jQuery)}(function(e){"use strict";var n={},t=0;e.fn.once=function(r,i){"string"!=typeof r&&(r in n||(n[r]=++t),i||(i=r),r="jquery-once-"+n[r]);var o=r+"-processed",s=this.not("."+o).addClass(o);return e.isFunction(i)?s.each(i):s},e.fn.removeOnce=function(n,t){var r=n+"-processed",i=this.filter("."+r).removeClass(r);return e.isFunction(t)?i.each(t):i}});